---
title:  "[TF_Tutorial] On-device Real-time Hand Tracking" 

categories:
  -  TF_Tutorial
tags:
  - [ML, tutorial]

toc: true
toc_sticky: true

date: 2022-02-28
last_modified_at: 2022-02-28
---

**Main Reference: <br>- [TensorFlow Blog : 3D Hand Pose with MediaPipe and TensorFlow.js](https://blog.tensorflow.org/2021/11/3D-handpose.html) <br>- [Google AI Blog : On-Device, Real-Time Hand Tracking with MediaPipe](https://ai.googleblog.com/2019/08/on-device-real-time-hand-tracking-with.html) <br>- [MediaPipe - Hands](https://google.github.io/mediapipe/solutions/hands.html)** 
{: .notice--warning}



**Paper: <br>- [MediaPipe Hands: On-device Real-time Hand Tracking](https://github.com/inhopp/inhopp/files/8153383/MediaPipe.Hands._.On-device.Real-time.Hand.Tracking.pdf)**
{: .notice--primary}


<br>


# ğŸš¤ Introduction

| Example1 | Example2 |
|:-:|:-:|
|![2](https://user-images.githubusercontent.com/96368476/155987751-499a3007-1343-4962-9f9a-2a5894795474.gif)|![1](https://user-images.githubusercontent.com/96368476/155987674-c5bf968d-ae33-4b37-a887-a069a9a31fb1.gif)|


<br>

![4](https://user-images.githubusercontent.com/96368476/155989618-6187c2e9-0ef9-4a92-87db-5187443d06cc.gif){: width="70%" height="80%" .align-left}

<br>

Hand Tracking ê¸°ìˆ ì€ ê¸°ê³„ì˜ ì œìŠ¤ì²˜ ì œì–´, ìˆ˜í™” ì´í•´ ë“± ì—¬ëŸ¬ í”Œë«í¼ì—ì„œ ì¤‘ìš”í•œ êµ¬ì„± ìš”ì†Œê°€ ë  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ì‹¤ì œ ì„¸ê³„ì˜ ì •ë³´ì™€ ë””ì§€í„¸ ì •ë³´ê°€ ê²¹ì³ì§€ëŠ” VR/AR ë¶„ì•¼ì—ì„œëŠ” í•µì‹¬ì ì¸ ê¸°ìˆ ì´ë‹¤. ê¸°ì¡´ì˜ Hand Tracking ëª¨ë¸ë“¤ì€ ì†ì— ì¥ë¹„ë¥¼ ì°©ìš©í•˜ê±°ë‚˜, íŠ¹ìˆ˜í•œ ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í•˜ëŠ” í•˜ë“œì›¨ì–´ì— ì˜ì¡´ì ì¸ ë°©ì‹ì´ì—ˆì§€ë§Œ ìš°ë¦¬ëŠ” ì´ë¥¼ ê·¹ë³µí•˜ê³  ë‹¤ìŒ ì„±ê³¼ë¥¼ ë‹¬ì„±í•˜ì˜€ë‹¤.
- ì¹´ë©”ë¼ ì´ì™¸ì— ì¶”ê°€ì ì¸ í•˜ë“œì›¨ì–´ëŠ” í•„ìš”ì—†ë‹¤.
- 2ê°œ ì´ìƒì˜ ì†ë„ íƒì§€í•  ìˆ˜ ìˆê³ , ì†ì˜ ì¼ë¶€ê°€ ê°€ë ¤ì§€ë”ë¼ë„ íƒì§€ëœë‹¤.
- ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì‹¤ì‹œê°„ ì—°ì‚°ì´ ê°€ëŠ¥í•˜ë‹¤.


<br>


# ğŸš¤ Model Architecture

ë³¸ ëª¨ë¸ì€ 2 stage Detector êµ¬ì¡°ë¥¼ ì´ë£¨ê³  ìˆë‹¤.

1. Bounding boxë¥¼ ì°¾ëŠ” ì†ë°”ë‹¥ Detector
2. ê° Bounding box(ì†) ë³„ë¡œ 21ê°œì˜ keypoints íƒì§€


<br>

## Palm Detector (ì†ë°”ë‹¥ íƒì§€)

![6](https://user-images.githubusercontent.com/96368476/155994537-17b18a91-0aaa-4426-a63e-aa54ae371039.png){: width="40%" height="50%" .align-center}

<br>

Palm DetectorëŠ” ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì‹¤ì‹œê°„ ì–¼êµ´ íƒì§€ì— ì‚¬ìš©ë˜ë˜ BlazeFace ëª¨ë¸ê³¼ ë¹„ìŠ·í•˜ê²Œ ì„¤ê³„í–ˆë‹¤. ê·¸ë¦¼ì„ ë³´ë©´ convolution ì¤‘ê°„ì¤‘ê°„ feature mapì„ ì‚¬ìš©í•˜ëŠ” FPN(Feature Pyramid Network)êµ¬ì¡°ì™€ ìœ ì‚¬í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë° ì™œ Hand Detectorê°€ ì•„ë‹Œ Palm Detectorë¥¼ ì‚¬ìš©í–ˆì„ê¹Œ? ì†ì˜ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ê²ƒì´ ìƒê°ë³´ë‹¤ ì‰½ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. ì–¼êµ´ì˜ ê²½ìš° ëˆˆ. ì½”, ì… ë“± ëšœë ·í•œ íŠ¹ì§•ë“¤ì´ ìˆëŠ” ë°˜ë©´ ì†ì—ì„œëŠ” ê·¸ë ‡ë‹¤ í•  íŠ¹ì§•ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì†ì´ ì•„ë‹Œ ì†ë°”ë‹¥(ì†ê°€ë½ ëº€), Palm Detectorë¥¼ ì‚¬ìš©í–ˆìœ¼ë©° ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì´ ì¡´ì¬í•œë‹¤.
- ì†ì—ë¹„í•´ NMS(Non-Max Suppression)ê°€ ì˜ ë¨¹íŒë‹¤.
  - ì†ê°€ë½ ê°™ì´ ì‚ì­‰ì‚ì­‰í•˜ë©´ Region Proposalì´ ì‰½ì§€ ì•Šë‹¤.
  - [Object Detection ë°°ê²½ì§€ì‹](https://inhopp.github.io/paper/Paper2/) ì°¸ê³ 
- ì†ë°”ë‹¥ì˜ bounding box ëª¨ì–‘ì€ ì •ì‚¬ê°í˜•ë§Œ ê³ ë ¤í•´ë„ ëœë‹¤.
  - ì¼ë°˜ì ì¸ Region Proposalì€ ê°€ë¡œ:ì„¸ë¡œ ë¹„ìœ¨ì´ 1:1, 1:2, 2:1ì¸ ê²½ìš°ë¥¼ ê³ ë ¤í•œë‹¤.
- focal lossë¥¼ ì´ìš©í•œë‹¤.
  - object detectionì—ì„œ ì‚¬ìš©í•˜ëŠ” loss function. (ë”°ë¡œ ì •ë¦¬í•´ì„œ ë¸”ë¡œê¹… í•˜ê² ìŠµë‹ˆë‹¤)



<br>

## Hand Landmark Model

![7](https://user-images.githubusercontent.com/96368476/155994544-d103e93f-ac3e-4c39-8915-557d96b72029.png){: width="70%" height="80%" .align-center}

<br>

- **Input Data**
  - Real world, Synthetic Images : ì•„ë˜ datasets ëª©ì°¨ì—ì„œ ë‹¤ë£¸
  - Hand Presence : 'ì™¼ì†/ì˜¤ë¥¸ì†' ë¼ë²¨ë§
  - Handedness : 'ì´ë¯¸ì§€ì— ì†ì´ ì¡´ì¬í•˜ëŠ”ê°€?' ë¼ë²¨ë§

<br>

## Output : 21 3D LandMarks

![5](https://user-images.githubusercontent.com/96368476/155993065-f1b57661-3601-4d9b-9625-92584ab680a7.png){: width="70%" height="80%" .align-center}

- ì—¬ê¸°ì„œ ì£¼ëª©í•  ì ì€ ëŒ€ëµì ì¸ ì† ëª¨ì–‘ì€ ì •í•´ì ¸ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.
- ë”°ë¼ì„œ keypointsë§Œ êµ¬í•˜ë©´ 3D ì† ëª¨ì–‘ì„ ë¹„êµì  ì •í™•í•˜ê²Œ ë Œë”ë§ í•  ìˆ˜ ìˆë‹¤.
- ì´ë¥¼ í†µí•´ ìƒëŒ€ì ì¸ ê¹Šì´(relative depth dimension) ì°¨ì›ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.
- 2 + 1 = 3D (x, y, relative depth) coordinate

<br>

![8](https://user-images.githubusercontent.com/96368476/156002372-5c077b67-1ad8-4a42-ae8b-e8056afd3b2d.gif){: width="30%" height="40%" .align-left}

- 3D keypoints. ê¹Šì„ ìˆ˜ë¡ ì§„í•œ ìƒ‰ìœ¼ë¡œ í‘œí˜„ëœë‹¤.



<br>

## Implementation in MediaPipe

MideaPipeë¥¼ ì´ìš©í•œ ë³¸ ëª¨ë¸ì˜ í•µì‹¬ì ì¸ ìµœì í™” ë°©ë²•ì€ Palm Detectorë¥¼ í•„ìš”í•œ ê²½ìš°ì—ë§Œ(ë§¤ìš° ë“œë¬¼ê²Œ) ì‹¤í–‰í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

![9](https://user-images.githubusercontent.com/96368476/156008874-94d3aa17-94d8-4b00-a279-8940794eed57.png){: width="50%" height="60%" .align-center}

í˜„ì¬ í”„ë ˆì„ì—ì„œ LandMarksë¥¼ ê³„ì‚°í•  ë•Œ Hand bounding boxë¥¼ ë†“ì³¤ëŠ”ì§€ ì—¬ë¶€ë¥¼ flagë¡œ ì„¤ì •í•œë‹¤(Handedness ê°’). ë§Œì•½ ì†ì„ ë†“ì¹˜ì§€ ì•Šì•˜ë‹¤ë©´ Palm detectingì„ ì‹¤í–‰í•˜ì§€ ì•Šê³  í˜„ì¬ í”„ë ˆì„ì˜ keypointsì—ì„œ í›„ì† í”„ë ˆì„ì˜ ì† ìœ„ì¹˜ë¥¼ ì¶”ì •í•œë‹¤. ì´ë¥¼ ê·¸ë˜í”„ë¡œ í‘œê¸°í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![11](https://user-images.githubusercontent.com/96368476/156010865-42b7884c-8c0e-4e60-845a-7cc0849142e4.png){: width="60%" height="70%" .align-center}

<br>

![10](https://user-images.githubusercontent.com/96368476/156008879-d2069648-5864-4363-94cb-0863412ae967.jpg)

- ì™¼ìª½ ê·¸ë¦¼ : ë§¨ ì²˜ìŒ ì‹œí–‰
- Flag_off : ì† ë†“ì¹˜ì§€ ì•ŠìŒ
  - Palm Detecting ì‹¤í–‰í•˜ì§€ ì•Šê³  ë°”ë¡œ RandMarks ê³„ì‚°
- Flag_on : ì† ë†“ì¹¨
  - Palm Detecting ë‹¤ì‹œ ì‹¤í–‰
  - ì´í›„ RandMarks ê³„ì‚°




<br>


# ğŸš¤ Datasets

ê° ëª©ì ì— ë”°ë¼ ì„¸ ê°€ì§€ datasetì„ ì´ìš©í•´ ëª¨ë¸ì„ í›ˆë ¨ì‹œì¼°ë‹¤.

## In-the-wild dataset

ì¼ë°˜ì ì¸ ì´ë¯¸ì§€ 6ì²œ ì¥
- ë‹¤ì–‘í•œ ë°°ê²½
- ë‹¤ì–‘í•œ ì†ì˜ í¬ê¸°
- Negative Sample (ì† ì—†ìŒ)

<br>

## In-house collected gesture dataset

ë””í…Œì¼ ì¤‘ì‹¬ì˜ ì´ë¯¸ì§€ 1ë§Œ ì¥
- ë°°ê²½ê³¼ ì†ì˜ í¬ê¸°ëŠ” ì œí•œ
- ì†ì˜ ê°ë„ì™€ ê°€ëŠ¥í•œ ì œìŠ¤ì²˜ì— ì§‘ì¤‘

<br>

## Synthetic dataset (í•©ì„± ì´ë¯¸ì§€)

![12](https://user-images.githubusercontent.com/96368476/156013156-60dccbc3-3b54-4d2e-9ce9-6f5cab570799.png){: width="60%" height="70%" .align-left}

- ê·¸ë¦¼ì˜ ìƒë‹¨ : real-world dataset
- ê·¸ë¦¼ì˜ í•˜ë‹¨ : RandMarksë¥¼ ì´ìš©í•œ ì† 3D ë Œë”ë§ + ë‹¤ì–‘í•œ ë°°ê²½ í•©ì„±

<br>

**Datasetì— ë”°ë¥¸ ì„±ëŠ¥**

![13](https://user-images.githubusercontent.com/96368476/156015032-41cb343c-8fb0-465d-89f3-3c087dacc1ef.png){: width="40%" height="50%" .align-left}




<br>


# ğŸš¤ Perfomance

![15](https://user-images.githubusercontent.com/96368476/156016386-4ef661c2-189e-4463-b7ce-fe5a14793494.png){: width="60%" height="70%" .align-left}

- ë³¸ ëª¨ë¸ì˜ ëª©ì ì€ ëª¨ë°”ì¼ í™˜ê²½ì—ì„œì˜ ì‹¤ì‹œê°„ ì—°ì‚°
- **<span style="color:red">accuracy vs speed</span>** trade-off ê´€ê³„ë¡œ 3 ê°€ì§€ ëª¨ë¸ ì¡´ì¬
- Light ëª¨ë¸ì˜ ê²½ìš° ì•„ì´í° ë””ë°”ì´ìŠ¤ì—ì„œ 1.1ms. ë””ê²Œ ë¹ ë¦„
- Pixel 3ê°€ ë­”ê°€ í–ˆë”ë‹ˆ êµ¬ê¸€ì—ì„œ ë§Œë“  í•¸ë“œí° (ì´ê²Œ ì‚¬íšŒìƒí™œ..?)

<br>

![14](https://user-images.githubusercontent.com/96368476/156016382-fc39a5df-e188-4824-8575-4ad9f861d2e3.png){: width="60%" height="70%" .align-left}

- ë¯¸êµ­ ìˆ˜í™” ë°ì´í„°ì— ëŒ€í•œ ì„±ëŠ¥ í‰ê°€
- ì´ì „ ëª¨ë¸ì— ë¹„í•´ ì„±ëŠ¥ì´ ì–´ë§ˆì–´ë§ˆí•˜ê²Œ ì¢‹ì•„ì§



<br>


# ğŸš¤ ì‹¤ìŠµ ì½”ë“œ

**[Tutoral Code](https://github.com/inhopp/ML_code/blob/main/hand_pose.ipynb) <br> [Live Web Demo](https://storage.googleapis.com/tfjs-models/demos/hand-pose-detection/index.html?model=mediapipe_hands)**
{: .notice--primary}

| Input | Hands Pose Detection |
|:-:|:-:|
|![input](https://user-images.githubusercontent.com/96368476/156019811-e67373d6-8068-40a5-8b53-314ed596ebb0.gif)|![output](https://user-images.githubusercontent.com/96368476/156019791-f3dc58ba-8564-4451-9fb7-2d529b1b2201.gif)|

<br>

TensorFlow Blog ê¸€ë“¤ì„ êµ¬ê²½í•˜ë‹¤ ë³´ë©´ ê¸°ìˆ ì´ ë„ˆë¬´ ì¢‹ì•„ì„œ ê¹œì§ê¹œì§ ë†€ë€ë‹¤. ì´ ë…¼ë¬¸ë„ 2020ë…„ì— ë‚˜ì™”ë˜ë° ìš”ì¦˜ vision ë¶„ì•¼ê°€ í­ë°œì ìœ¼ë¡œ ì„±ì¥í•˜ëŠ” ê²ƒ ê°™ë‹¤. ë‚´ê°€ ê³µë¶€í•˜ê³  ì‹¶ì€ ë¶„ì•¼ì— ì¬ë°ŒëŠ” ê¸°ìˆ ë“¤ì´ ìŸì•„ì§€ëŠ” ê±¸ ë³´ë©´ ì—­ì‹œ ë‚˜ëŠ” ìš´ì´ ì¢‹ë‚˜ ë³´ë‹¤.


<br>
<br>

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
---
title:  "[Paper Review] Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks (CycleGAN)" 

categories:
  -  Paper
tags:
  - [ML, Generative]

toc: true
toc_sticky: true

date: 2023-06-03
last_modified_at: 2023-06-03
---

**Main Reference: <br>- [CycleGAN Paper](https://arxiv.org/abs/1703.10593)**
{: .notice--primary}

<br>


# ğŸš€ Introduction

| Image-to-Image Translation | Dataset |
|:-:|:-:|
| ![1](https://github.com/inhopp/inhopp/assets/96368476/ccd77f02-287f-47b4-ba43-19089ae06c38) | ![2](https://github.com/inhopp/inhopp/assets/96368476/875e7125-3116-48e3-9a62-51b46c0c7871) |

ê¸°ì¡´ Image-to-Image translation taskëŠ” paired supervised learningì„ í†µí•´ í•´ê²°ë˜ì–´ ì™”ë‹¤. í•˜ì§€ë§Œ ë¬¸ì œëŠ” paired datasetì„ ì–»ê¸°ê°€ ë„ˆë¬´ í˜ë“¤ê³  ë¹„ì‹¸ë‹¤ëŠ” ê²ƒì´ë‹¤. ì‹¬ì§€ì–´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë„ ì¡´ì¬í•œë‹¤. ë³¸ ë…¼ë¬¸ì€ paired dataset ì—†ì´, ë„ë©”ì¸ ë‹¨ìœ„ë¡œ í•™ìŠµí•˜ê³  ë§¤í•‘í•˜ëŠ” ë°©ì‹ì„ ì œì•ˆí–ˆë‹¤. ì´ë•Œ ì¼ë°˜ì ì¸ GAN lossë¡œëŠ” ê°œë³„ì ì¸ input xì™€, output yê°€ paired ë˜ëŠ” ê²ƒì´ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼ GANì˜ ê³ ì§ˆì ì¸ ë¬¸ì œì¸ mode collapseì— ë¹ ì§ˆ ìœ„í—˜ë„ ì¡´ì¬í•œë‹¤. ë”°ë¼ì„œ ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ "cycle consistenct loss" termì„ ì¶”ê°€í•˜ì˜€ë‹¤. 


<br>


# ğŸš€ Formulation

![3](https://github.com/inhopp/inhopp/assets/96368476/98224c34-1ff9-4f51-a9cf-bf9789d791c0){: width="60%" height="70%" .align-center}



$$  \textbf{L}_{GAN} (G, D_{Y}, X, Y) =  \mathbb{E}_{y \sim P_{data}(y)}[log D_{Y}(y)] + \mathbb{E}_{x \sim P_{data}(x)}[ log(1 - D_{Y}(G(x)))] $$

$$  \textbf{L}_{cyc} (G, F) =  \mathbb{E}_{x \sim P_{data}(x)}[\left\| F(G(x)) - x  \right\|_{1}] + \mathbb{E}_{y \sim P_{data}(y)}[\left\| G(F(y)) - y  \right\|_{1}] $$

$$ \textbf{L}_{total} (G, F, D_{X}, D_{Y}) = \textbf{L}_{GAN} (G, D_{Y}, X, Y) + \textbf{L}_{GAN} (F, D_{X}, Y, X) + \lambda \textbf{L}_{cyc} (G, F) $$ 

CycleGANì˜ ëª©ì ì€ ë‘ ë„ë©”ì¸ ì‚¬ì´ì˜ ë§¤í•‘ì„ í•™ìŠµí•˜ëŠ” ê²ƒì´ë‹¤. ëª¨ë¸ì€ ë‘ ê°œì˜ Generator G,Fì™€ ë‘ ê°œì˜ Discriminator $$\textbf{D}_{X} , \textbf{D}_{Y}$$ ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , Objective Functionì€ adversarial loss + cycle consistency lossë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. <br>ì´ë¡ ì ìœ¼ë¡œ adverarial trainingì€ ìˆ˜ë ´ì„±ì´ ì¦ëª…ë˜ì–´ ìˆë‹¤. í•˜ì§€ë§Œ ì¶©ë¶„íˆ í° ë°ì´í„° ë¶„í¬ì— ëŒ€í•´ì„œëŠ” íŠ¹ì • setë§Œì„ ìƒì„±í•˜ëŠ” mode collapse ë¬¸ì œì— ë¹ ì§ˆ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ë„ë©”ì¸ ë‚´ì— ì¡´ì¬í•˜ëŠ” ë‹¤ì–‘í•œ ë¶„í¬ë¥¼ í‘œí˜„í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” cycle consistency lossë¥¼ ì¶”ê°€ì ìœ¼ë¡œ í•™ìŠµí•´ì•¼ í•œë‹¤. ì´ë•Œ cyc lossë¥¼ l1ë§ê³ ë„ ë‹¤ì–‘í•˜ê²Œ ì‹œë„í•´ë´¤ëŠ”ë° ë”±íˆ ì„±ëŠ¥ ì°¨ì´ëŠ” ì—†ì—ˆë‹¤ê³  í•œë‹¤.


<br>


# ğŸš€ Implementation

| Generator | Discriminator |
|:-:|:-:|
| ![4](https://github.com/inhopp/inhopp/assets/96368476/a6a0de8d-37f1-4f19-8734-6623b64ac7ff) | ![5](https://github.com/inhopp/inhopp/assets/96368476/2316df6b-6bee-400b-b064-7a247ae8ffa3) |

$$ \textbf{train G to minimize} \quad \mathbb{E}_{x \sim P_{data}(x)}[(D(G(X))-1)^{2}] $$

$$ \textbf{train D to minimize} \quad \mathbb{E}_{y \sim P_{data}(y)}[(D(y) - 1)^{2}] + \mathbb{E}_{x \sim P_{data}(x)}[(D(G(X)))^{2}] $$

GeneratorëŠ” nueral style transferì—ì„œ ì¸ìƒì ì¸ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤€ Johnsonì˜ êµ¬ì¡°ë¥¼ ì°¸ê³ í–ˆë‹¤(Residual blocks + instance normalization). DiscriminatorëŠ” PatchGAN êµ¬ì¡°ë¥¼ ì‚¬ìš©í–ˆë‹¤. í•™ìŠµì„ ì•ˆì •í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ë‘ ê°€ì§€ ê¸°ë²•ì„ ì‚¬ìš©í–ˆë‹¤.

- GAN lossì˜ ê¸°ì¡´ ë°©ì‹ì¸ negative log-likelihood loss ëŒ€ì‹  least squares lossë¥¼ ì‚¬ìš©í–ˆë‹¤.
  - log-lekelihood lossë¥¼ ì´ìš©í•œ GANì˜ GeneratorëŠ” Discriminatorë¥¼ ì†ì´ê¸°ë§Œ í•˜ê²Œë” í•™ìŠµì´ ì§„í–‰ë˜ê¸° ë•Œë¬¸ì— íŠ¹ì • dataì˜ featureë¥¼ í•™ìŠµí•˜ê¸° í˜ë“¤ë‹¤ê³  í•œë‹¤.
- ëª¨ë¸ì˜ í•™ìŠµì´ ë¶ˆì•ˆì •í•œ ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” Discriminatorê°€ ê°€ì¥ ìµœê·¼ ìƒì„±ëœ ì´ë¯¸ì§€ë§Œì„ í•™ìŠµí•˜ê¸° ë•Œë¬¸ì´ë‹¤.
  - ë”°ë¼ì„œ ê°€ì¥ ìµœê·¼ í•©ì„±ëœ 1ì¥ì˜ ì´ë¯¸ì§€ê°€ ì•„ë‹Œ ìµœê·¼ 50ì¥ì˜ ì´ë¯¸ì§€ë¥¼ í†µí•´ Discriminatorë¥¼ í•™ìŠµí–ˆë‹¤.
- Cycle consistency lossì˜ ê°€ì¤‘ì¹˜ lambdaëŠ” ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ 10ì´ ì ë‹¹í•˜ë‹¤.



<br>



# ğŸš€ Results

![6](https://github.com/inhopp/inhopp/assets/96368476/4f11cb22-0a30-4df2-ba8e-f44b2ce4d915){: width="60%" height="70%" .align-center} 

- Loss ì´ê²ƒì €ê²ƒ ë¹¼ë³´ë©° í…ŒìŠ¤íŠ¸

<br>

![7](https://github.com/inhopp/inhopp/assets/96368476/18fde89f-d0e1-4fe9-83ef-9f1cd61e0d2a){: width="60%" height="70%" .align-center} 

- ë§ˆì§€ë§‰ photo <-> maps ì˜ˆì œì˜ ê²½ìš° í•˜ë‚˜ì˜ ë„ë©”ì¸ì´ ë‹¤ë¥¸ ë„ë©”ì¸ë³´ë‹¤ í›¨ì”¬ ë§ì€ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. ê·¸ë˜ë„ ì˜ ë‚˜ì˜¤ë”ë¼.

<br>

![8](https://github.com/inhopp/inhopp/assets/96368476/a18c33b2-3df4-4eeb-8e1f-0658a4a878b9){: width="60%" height="70%" .align-center}

- inputê³¼ outputì˜ color compositionì´ ì¤‘ìš”í•œ ê²½ìš°(ex. ë°¤ ë‚® ë°”ê¾¸ê¸°) Identity loss ì¶”ê°€í•´ì£¼ë©´ ë„ì›€ ë¨

<br>

![9](https://github.com/inhopp/inhopp/assets/96368476/b160d3e2-e9f9-47b0-9eb0-df21541afadc){: width="60%" height="70%" .align-center}

- Style Transfer ê¸°ê¹”ë‚˜ê²Œ í•¨..




<br>


# ğŸš€ Discussion

![10](https://github.com/inhopp/inhopp/assets/96368476/69a79dbb-eec2-4312-b9ff-146e5691014a){: width="60%" height="70%" .align-center}

ì €ìë“¤ì´ ë§í•˜ëŠ” limitationì—ëŠ” geometricí•œ ë³€í™˜ì€ ì˜ ëª»í•œë‹¤ëŠ” ì ì´ ìˆì—ˆë‹¤. Generatorê°€ inputì˜ êµ¬ì¡°ë¥¼ ë°˜ì˜í•´ì£¼ëŠ” UNetêµ¬ì¡°ë„ ì•„ë‹Œë° ì™œ ëª»í•˜ëŠ”ì§€ ì˜ ëª¨ë¥´ê² ë‹¤. ë˜ í•œê°€ì§€ íŠ¹ì´í•œ ì ì€ Generatorì˜ êµ¬ì¡°ì´ë‹¤. ë³´í†µ UNetì˜ ê²½ìš° inputì´ ì­‰ ì‘ì•„ì¡Œë‹¤ê°€ bottleneck layerë¥¼ ê±°ì¹œ í›„ ë°”ë¡œ upscalingì— ë“¤ì–´ê°„ë‹¤. ê·¸ëŸ°ë° CycleGANì˜ ê²½ìš° bottleneck ë¶€ë¶„ layerê°€ ë¬´ë ¤ 9ê°œ ì´ë‹¤. ì´ëŸ° êµ¬ì¡°ê°€ style transferë¥¼ ì˜ í•´ì£¼ë‚˜..? í•˜ëŠ” ì¶”ì¸¡. ê·¸ë¦¬ê³  bottleneck ë¶€ë¶„ì— residual blockì„ ì‚¬ìš©í–ˆëŠ”ë°, ì²˜ìŒì— ì•½ê°„ í˜¼ë€ì´ ì™”ì—ˆë‹¤. Skip connectionì˜ ì—­í• ì€ glbal structureë¥¼ ë°˜ì˜í•´ì£¼ëŠ” ê²ƒì¸ë°, ë‹¤ ì••ì¶•í•˜ê³  ë‚˜ì„œ í•˜ëŠ” skip connectionì´ ë¬´ìŠ¨ ì˜ë¯¸ê°€ ìˆë‚˜ ìƒê°í–ˆë‹¤. Skip connectionì˜ ë³¸ë˜ ì—­í• ì´ gradientê°€ ì˜ íë¥´ë„ë¡ í•´ì¤€ë‹¤ëŠ” ê²ƒì„ ê¹Œë¨¹ê³  ìˆì—ˆë‹¤.

# ğŸš€ Code

> [CycleGAN from scartch (pytorch)](https://github.com/inhopp/CycleGAN)

| Input | Gogh | Monet |
|:-:|:-:|:-:|
| ![temp](https://github.com/inhopp/inhopp/assets/96368476/1970e94e-2e5e-437d-9c8c-60abdbba31c3) | ![output](https://github.com/inhopp/inhopp/assets/96368476/4c532445-7241-4fba-93ff-5f3ed473a2c7) | ![output2](https://github.com/inhopp/inhopp/assets/96368476/48cdbcde-0ed8-4b9d-9af0-b1433cb15afc) |

ì™œ ë‚´ ëª¨ë¸ì€ ì•ˆ ì˜ˆìœ ê²ƒì¸ê°€



<br>
<br>



[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
---
title:  "[ë…¼ë¬¸ ë¦¬ë·°] Fast R-CNN" 

categories:
  -  Paper
tags:
  - [ML, Object Detection]

toc: true
toc_sticky: true

date: 2022-09-13
last_modified_at: 2022-09-13
---

**Paper: <br>- [Fast R-CNN](https://github.com/inhopp/inhopp/files/9548881/Fast.RCNN.pdf)**
{: .notice--primary}


<br>

# ğŸš€ Abstract

Fast R-CNNì€ ê¸°ì¡´ì˜ Detection ëª¨ë¸ì¸ R-CNNê³¼ SPPnetì„ ê°œì„ í•´ ì •í™•ë„ì™€ ì†ë„ ëª¨ë‘ë¥¼ ë†’ì´ëŠ”ë° ì„±ê³µí–ˆë‹¤. íŠ¹íˆ test inferenceì˜ ê²½ìš° R-CNNì— ë¹„í•´ ë¬´ë ¤ 213ë°°ë‚˜ ë¹ ë¥´ë‹¤.



<br>

# ğŸš€  Introduction

ìµœê·¼ (2015ë…„) cnnì„ í†µí•œ ë¶„ë¥˜ ì‘ì—…ì€ í° ì„±ê³¼ë¥¼ ì´ë£¨ì—ˆë‹¤. ë‹¤ë§Œ detectionì˜ ê²½ìš° classificationì— ë¹„í•´ ë¬¸ì œê°€ ì¡°ê¸ˆ ë³µì¡í•´ì§„ë‹¤. ë¬¼ì²´ì˜ ì •í™•í•œ ìœ„ì¹˜ë¥¼ íŒŒì•…í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì¸ë°, ì´ê²Œ ìƒê°ë³´ë‹¤ ì–´ë ¤ìš´ ì‘ì—…ì´ë‹¤.
- ìˆ˜ë§ì€ ì˜ì—­(RoI)ë“¤ì„ í™•ì¸í•´ë´ì•¼ í•œë‹¤. (R-CNN ê¸°ì¤€ ì´ë¯¸ì§€ë‹¹ 2000ê°œì˜ ì˜ì—­)
- Selective Searchë¥¼ í†µí•´ ì œì•ˆëœ ì˜ì—­ì€ ëŒ€ë½ì ì¸ ìœ„ì¹˜ì´ë¯€ë¡œ ì¡°ì • ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.


## R-CNN and SPPnet

| R-CNN | SPPnet |
|:-:|:-:|
| ![rcnn](https://user-images.githubusercontent.com/96368476/189808714-226b6b1b-80e5-4bf0-b5e8-480df65f0f1b.png) | ![sppnet](https://user-images.githubusercontent.com/96368476/189808721-c31e4062-b48e-4d40-a760-0f428c6315cb.png) | 

R-CNNì˜ ê²½ìš° ì„±ê³µì ì¸ detection ëª¨ë¸ì´ë¼ í•  ìˆ˜ ìˆì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ì ë“¤ì´ ì¡´ì¬í•œë‹¤.

1. Training is multi-stage pipeline
  - classification ë”°ë¡œ, box regression ë”°ë¡œ ê³„ì‚°í•¨
  - ì‹¬ì§€ì–´ classificationì€ cnn ê±°ì¹œ í›„ SVM ê³„ì‚°

2. Training is expensive in space and time
  - ìˆ˜ë§ì€ ì˜ì—­ì— ëŒ€í•´ inferenceë¥¼ í•´ë´ì•¼ í•˜ë‹ˆ ì‹œê°„ë„ ì˜¤ë˜ê±¸ë¦¬ê³ , ë©”ëª¨ë¦¬ë„ ì—„ì²­ ë§ì´ í•„ìš”í•¨

3. Detection is slow
  - R-CNNì˜ ê²½ìš° ì´ë¯¸ì§€ í•œ ì¥ inferenceí•˜ëŠ”ë° 47ì´ˆë‚˜ í•„ìš”í•¨.
  - real-timeì€ ì–´ë¦¼ë„ ì—†ëŠ” ì‹œê°„

R-CNN ì´í›„ ì œì•ˆëœ SPPnetì˜ ê²½ìš° ì „ì²´ ì´ë¯¸ì§€ì— ë¨¼ì € convolutionì—°ì‚° í›„ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•œë‹¤.
ë”°ë¼ì„œ ë‚­ë¹„ë˜ë˜ ë§ì€ ì—°ì‚°ë“¤ì„ ê³µìœ í•˜ê³ , ì†ë„ë„ ê°œì„ ì‹œì¼°ë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ multi-pipelineì´ë¼ëŠ” ë‹¨ì ì€ í•´ê²°í•˜ì§€ ëª»í–ˆê³ , SPPnetì—ì„œ ì œì•ˆí•œ fine-tuning ê¸°ë²•ìœ¼ë¡œëŠ” conv layerë¥¼ í•™ìŠµí•˜ì§€ ëª»í–ˆë‹¤(R-CNNì€ ê°€ëŠ¥í–ˆë‹¤). <br>

ë³¸ ë…¼ë¬¸ì—ì„œëŠ” ìœ„ ë‹¨ì ë“¤ì„ ê·¹ë³µí•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§„ ìƒˆë¡œìš´ Detection ëª¨ë¸, Fast R-CNNì„ ì œì•ˆí•œë‹¤.
- accuracy & speed ëª¨ë‘ ê°œì„ 
- multi-stageê°€ ì•„ë‹Œ single-stage training
- ë„¤íŠ¸ì›Œí¬ì˜ ëª¨ë“  layerë“¤ì„ í•™ìŠµí•  ìˆ˜ ìˆìŒ



<br>


# ğŸš€ Fast R-CNN architecture and training

![architecutre](https://user-images.githubusercontent.com/96368476/189818457-e55f8520-f65e-43c9-84d4-b11e20ecd0a4.png){: width="70%" height="80%" .align-center}

Fast R-CNNì˜ í•µì‹¬ì€ ë‹¤ìŒ ë‘ ê°€ì§€ë¼ í•  ìˆ˜ ìˆë‹¤. <br>
1. ê¸°ì¡´ì˜ ë°©ì‹ì€ RoIë¥¼ inputìœ¼ë¡œ ë°›ì§€ë§Œ, fast rcnnì€ ì „ì²´ ì´ë¯¸ì§€(ì›ë³¸)ë¥¼ inputìœ¼ë¡œ ë°›ëŠ”ë‹¤.
2. classifyì™€ box regressionì„ single-stageë¡œ í•™ìŠµí•œë‹¤.

ì´ëŸ¬í•œ ì°¨ì´ì ì€ ë‹¨ìˆœí•´ ë³´ì´ì§€ë§Œ í•™ìŠµ ë°©ë²•ì— í° ë³€í™”ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

<br>

## RoI pooling layer

![pooling](https://user-images.githubusercontent.com/96368476/189819731-b4a330f6-1f83-4a92-82ce-7917be9869a9.png){: width="50%" height="60%" .align-center}

ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ region proposal â†’ roi projection â†’ fixed sizeë¡œ max pooling (7x7)


<br>


## Initializing from pretrained networks

Fast R-CNNì€ ê¸°ì¡´ì˜ R-CNNê³¼ ê°™ì´ pretrined network(e.g., VGG16)ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ë‹¤ìŒê³¼ ê°™ì€ ë³€í™˜ì„ í•´ì£¼ë©´ ëœë‹¤.

- ë„¤íŠ¸ì›Œí¬ì˜ ë§ˆì§€ë§‰ pooling layerë¥¼ RoI pooling layerë¡œ ë³€í™˜
- ë§ˆì§€ë§‰ softmax layerë¥¼ (classify + box regression) softmax layerë¡œ ë³€í™˜
- ë„¤íŠ¸ì›Œí¬ê°€ ë‘ ê°œì˜ input, ì´ë¯¸ì§€ + RoI ë¥¼ ë°›ë„ë¡ ë³€ê²½


<br>


## Fine-tuning for detection

### Multi-task loss

$$ \textbf{L}(p,u,t^{u},v) = \textbf{L}_{cls}(p,u) + \lambda [u \geq 1]\textbf{L}_{loc}(t^{u},v) $$

$$ p = (p_{0}, p_{1}, \cdots  , p_{k}) $$ 

$$ t^{u} = (t_{x}^{u}, t_{y}^{u}, t_{w}^{u}, t_{h}^{u}) $$

$$ \textbf{L}_{cls}(p, u) = -log(p_{u}) $$

$$ \textbf{L}_{loc}(t^{u}, v) = \sum_{i\in {x,y,w,h}}^{} smmoth_{L_{1}}(t_{i}^{u}-v_{i}) $$

$$ smooth_{L_{1}}(x) = 
\begin{cases}
0.5x^{2} & \text{ if } |x|<1 \\
|x| - 0.5 & \text{ otherwise, } 
\end{cases} $$

- p : (k+1)ê°œ í´ë˜ìŠ¤ì— ëŒ€í•œ class score ( k + background=0)
- u : inferenceí•˜ëŠ” ê°ì²´ì˜ ì‹¤ì œ class
- t^u : class uì— ëŒ€í•œ bounding box ë¹„ìœ¨ì„ ì¡°ì •í•˜ëŠ” ê°’
- v : ì‹¤ì œ bounding box ì¢Œí‘œ
- Î» : classify & box regression ë¹„ìœ¨ ì¡°ì • (default = 1)
- [ uâ‰¥1 ] : u=0ì¼ ê²½ìš° 0 (backgroundì¸ ê²½ìš° box regression ìˆ˜í–‰x), ë‚˜ë¨¸ì§€ 1
- R-CNN, SPPì—ì„œ box regressionì„ êµ¬í•  ë•Œì—ëŠ” L2 loss ì‚¬ìš©í–ˆëŠ”ë° ì¢…ì¢… gradient exploding ë°œìƒ. â†’ L1ìœ¼ë¡œ ë³€ê²½


<br>


### Mini-batch sampling








<br>
<br>



[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
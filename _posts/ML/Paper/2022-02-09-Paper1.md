---
title:  "[ë…¼ë¬¸ ë¦¬ë·°] Image Style Transfer Using Convolutional Neural Networks" 

categories:
  -  Paper
tags:
  - [ML, Paper]

toc: true
toc_sticky: true

date: 2022-02-09
last_modified_at: 2022-02-09
---

**Main Reference: <br>- [Deep Learning for Computer Vision](https://www.youtube.com/watch?v=dJYGatp4SvA&list=PL5-TkQAfAZFbzxjBHtzdVCWE0Zbhomg7r) <br>- [ê¼¼ê¼¼í•œ ë”¥ëŸ¬ë‹ ë…¼ë¬¸ ë¦¬ë·°ì™€ ì½”ë“œ ì‹¤ìŠµ](https://github.com/ndb796/Deep-Learning-Paper-Review-and-Practice)** 
{: .notice--warning}


**[Image Style Transfer Using Convolutional Neural Networks](https://github.com/inhopp/inhopp/files/8025046/Image.Style.Transfer.paper.pdf)**
{: .notice--primary}



<br>

# ğŸš€ Introduction

![3](https://user-images.githubusercontent.com/96368476/153019796-222dba35-08f7-4d7d-8fea-2d1d1dafa7b6.jpg)
{: width="60%" height="70%"}

Image Style Transferë€ Content ì´ë¯¸ì§€ í˜•ìƒ ìœ„ì— style ì´ë¯¸ì§€ì˜ styleì„ ì…íˆëŠ” ê²ƒì´ë‹¤. ê·¸ë¦¼ê³¼ ê°™ì´ í’ê²½ ì‚¬ì§„ ìœ„ì— ìœ ëª… í™”ê°€ë“¤ì˜ í™”í’ì„ ì ìš©í•˜ëŠ” ê²ƒì´ë‹¤. ë…¼ë¬¸ì— ë‚˜ì˜¨ ë°©ì‹ì€ noise imageì—ì„œ ì‹œì‘í•´ contentì™€ styleì„ reconstruction í•œë‹¤. ì¦‰, cnnì˜ ê°€ì¤‘ì¹˜ë“¤ì€ ê³ ì •ì‹œí‚¤ê³  noise ì´ë¯¸ì§€ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤. ë…¼ë¬¸ì—ì„œ ì‚¬ìš©í•œ cnn ëª¨ë¸ì€ pre-trained VGG19 ì´ë‹¤.

<br>

![4](https://user-images.githubusercontent.com/96368476/153026588-622ca670-cb34-4f18-832e-e6dd5588da3f.jpg)
{: width="50%" height="60%"}

ë…¼ë¬¸ì˜ í•µì‹¬ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
- ì´ë¯¸ì§€ì˜ styleì„ ì–´ë–»ê²Œ ì •ì˜í•  ê²ƒì¸ê°€?
- contentì™€ styleì„ ì–´ë–»ê²Œ reconstruction í•  ê²ƒì¸ê°€?




<br>


# ğŸš€ Content Reconstruction

content ì´ë¯¸ì§€ë¥¼ reconstructioní•˜ê¸° ìœ„í•´ content loss í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. ì´ í•¨ìˆ˜ëŠ” Lë²ˆì§¸ convolution layerì— ì¡´ì¬í•˜ëŠ” ië²ˆì§¸ í•„í„°ì— ëŒ€ì‘í•˜ëŠ” F matrixë¡œ í‘œí˜„ëœë‹¤.

![paper1-17](https://user-images.githubusercontent.com/96368476/153029638-cebd1487-704f-412d-bf0d-a992ec5b7b38.jpg)
{: width="50%" height="60%"}

\[L_{content}(\vec{p},\vec{x},l) = \frac{1}{2}\sum_{i,j}^{}(F_{ij}^{l}-P_{ij}^{l})^{2}\]

\[\frac{\partial L_{content}}{\partial F_{ij}^{l}} = (F^{l}-P^{l})_{ij}\]

- p: content image
- x: input image (noise)
- l: lë²ˆì§¸ layer
- F: noise image xë¥¼ ë„£ì—ˆì„ ë•Œ í™œì„±í™” ê°’
- P: content image pë¥¼ ë„£ì—ˆì„ ë•Œ í™œì„±í™”  ê°’ (ìƒìˆ˜)

<br>

ì—¬ê¸°ì„œ íŠ¹ì´í•œ ì ì€ ëª¨ë“  í•„í„°ë¥¼ ì‚¬ìš©í•´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šê³  4ë²ˆì§¸ layer 1ë²ˆ ì§¸ í•„í„°ë§Œì„ ì´ìš©í•´ reconstruction í•œë‹¤. ì‹¤ì œ ì½”ë“œë¥¼ ëŒë ¤ë³´ë©´ ì—…ë°ì´íŠ¸ ì†ë„ê°€ êµ‰ì¥íˆ ëŠë ¤ì„œ í•„í„°ì˜ ê°œìˆ˜ë¥¼ ì œí•œí•˜ëŠ” ê²ƒì€ ì´í•´ê°€ ê°„ë‹¤. ê·¸ëŸ°ë° ì™œ í•˜í•„ conv4_1 í•„í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì¼ê¹Œ?

<br>

![7](https://user-images.githubusercontent.com/96368476/153031734-4147c747-7327-4c8c-bbe0-5ba147d2d7f2.jpg)

Content Reconstructionsë¶€ë¶„ì„ ì‚´í´ë³´ì. aëŠ” ì²«ë²ˆ ì§¸ ë ˆì´ì–´ì— ì¡´ì¬í•˜ëŠ” í•„í„°ë¥¼ ì´ìš©í•´ reconstruction í•œ ê·¸ë¦¼ì´ê³  ê·¸ ì¤‘ íŠ¹ì • ë¶€ë¶„ì„ í™•ëŒ€í•œ ê·¸ë¦¼ì´ ì•„ë˜ì˜ ê²ƒì´ë‹¤. ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê°ˆìˆ˜ë¡ ì¦‰, ê¹Šì€ layerì˜ í•„í„°ë¥¼ ì‚¬ìš©í•œ ê²ƒì¼ìˆ˜ë¡ í•´ìƒë„ëŠ” ë–¨ì–´ì§„ë‹¤. ì´ëŠ” ê¹Šì€ layerì˜ í•„í„°ì¼ìˆ˜ë¡ ë” ë„“ì€ ì˜ì—­ì„ ì»¤ë²„í•˜ê³ , ê³ ì°¨ì›ì˜ íŠ¹ì§•ì„ í‘œí˜„í•˜ê¸° ë•Œë¬¸ì´ë‹¤. 

<br>

![8](https://user-images.githubusercontent.com/96368476/153033127-d0c8ecb9-9b7c-4f4b-a934-1312b145aaca.jpg)
{: width="50%" height="60%"}

ìœ„ ê·¸ë¦¼ì€ Content Imageë¥¼ ê°ê° Conv2_2 í•„í„°, Conv4_2 í•„í„°ë¥¼ ì´ìš©í•´ reconstructioní•œ ê²ƒì´ë‹¤. Conv2_2 í•„í„°ë¥¼ ì´ìš©í•œ ê²½ìš°, í™•ëŒ€í•œ ì‚¬ì§„ì„ ë³´ë©´ content imageì˜ ì €ì°¨ì› íŠ¹ì§•ì´ ë„ˆë¬´ ì„ ëª…í•´ì„œ ë‹¨ìˆœíˆ ìƒ‰ê¹”ë§Œ ì…í˜€ë†“ì€ ë“¯ í•˜ë‹¤. ë°˜ë©´ Conv4_2 í•„í„°ë¥¼ ì´ìš©í•˜ë‹ˆ í•´ìƒë„ê°€ ë–¨ì–´ì§€ì§€ë§Œ, ì˜¤íˆë ¤ ë” ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¤íƒ€ì¼ì´ í‘œí˜„ëœ ë“¯í•˜ë‹¤.





<br>


# ğŸš€ Style Reconstruction

ë³¸ ë…¼ë¬¸ì—ì„œëŠ” 'Style'ì„ Gram matrix Gë¼ëŠ” í–‰ë ¬ì„ ì´ìš©í•´ ì •ì˜í•œë‹¤. Gram matrixê°€ ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ì.

- í•„í„°ì˜ ê°œìˆ˜: N+1 (0,1,...,N)
- M: feature mapì˜ ê°€ë¡œ*ì„¸ë¡œ

![17](https://user-images.githubusercontent.com/96368476/153115154-f2fad544-7f4b-4561-a552-bf5aaeeb9595.jpg)
{: width="50%" height="60%"}
![15](https://user-images.githubusercontent.com/96368476/153115141-c0d3d04b-d9b9-48ae-aae1-1461080df2d8.jpg)
{: width="50%" height="60%"}
![18](https://user-images.githubusercontent.com/96368476/153115582-57b8f028-3944-413a-b793-fd267e76bcfa.jpg)
{: width="50%" height="60%"}

- ë…¼ë¬¸ì—ì„œ ì œì‹œí•œ ìŠ¤íƒ€ì¼ì´ë€?
- **<span style="color:red">Correlations between the different filter responses</span>**

<br>


\[G_{ij}^{l} = \sum_{k}^{}F_{ik}^{l}F_{jk}^{l}\]

\[E_{l} = \frac{1}{4N_{l}^{2}M_{l}^{2}}\sum_{i,j}^{}(G_{ij}^{l}-A_{ij}^{l})^{2}\]

\[L_{style}(\vec{a}, \vec{x}) = \sum_{l=0}^{L}w_{l}E_{l}\]

\[\frac{\partial E_{l}}{\partial F_{ij}^{l}} = \frac{1}{N_{l}^{2}M_{l}^{2}} {({(F^{l})}^{T}(G^{l} - A^{l}))}_{ji}\]

- Gram matrixëŠ” í¬ê¸°ê°€ í¬ê¸° ë•Œë¬¸ì— 4MNìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì •ê·œí™” í…€ì„ ê±°ì¹˜ëŠ” ë“¯ í•˜ë‹¤.
- AëŠ” style imageì˜ Gram matrix (ìƒìˆ˜)
- content reconstructionê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ëª¨ë“  layerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  conv1, conv2, conv3, conv4, conv5 ë‹¤ì„¯ ê°œì˜ layerë§Œ ì‚¬ìš©í•œë‹¤.
  - ì„±ëŠ¥ ì´ìŠˆ ë•Œë¬¸ì¸ ë“¯
- ì´ë•Œ wëŠ” 1/5ë¡œ ì§€ì •í•´ì¤€ í•˜ì´í¼ íŒŒë¼ë¯¸í„° ì´ë‹¤.
  - l = 0, 1, 2, 3, 4 (ë…¼ë¬¸ì—ì„œëŠ” 5ê°œì˜ layer ì‚¬ìš©)
- Gradientë¥¼ computed analyticallyí•˜ë©´ì„œ íˆ­ ë˜ì ¸ì£¼ëŠ”ë° ì•„ì§ ì´í•´í•˜ì§€ ëª»í–ˆë‹¤. ì¢€ ë” ê³ ë¯¼í•´ë´ì•¼ê² ë‹¤.


<br>


# ğŸš€ Style Transfer

![10](https://user-images.githubusercontent.com/96368476/153039052-cf473197-b723-46e9-9f2f-b16d5770d70c.jpg)

ì´ì œ content lossì™€ style lossë¥¼ ì •ì˜í–ˆìœ¼ë‹ˆ total lossë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ style lossì˜ ì •ê·œí™” í…€ ë•Œë¬¸ì¸ì§€ ì•ŒíŒŒê°€ 1, ë² íƒ€ê°€ 1000 ì´ëŸ° ì‹ì´ë”ë¼. ë˜ í•˜ë‚˜ íŠ¹ì´í•œ ì ì€ LBFGS ë¼ëŠ” ì²˜ìŒ ë³´ëŠ” optimizerë¥¼ ì“°ë˜ë° tensorflow coreì—ì„œëŠ” admaì¨ë„ ê´œì°®ë‹¤ê³  í•œë‹¤. ì•„ë§ˆ ì˜›ë‚ ì— ì“°ë˜ optimizerì¸ê°€ ë³´ë‹¤.





<br>



# ğŸš€ Result

## Trad-off between contentand style matching

![13](https://user-images.githubusercontent.com/96368476/153042093-f0ba076b-a340-4f87-8246-a8e81d1b0977.jpg)
{: width="60%" height="70%"}

\[L_{total} = \alpha L_{content} + \beta L_{style}\]

- ì•ŒíŒŒ/ë² íƒ€ ë¹„ìœ¨ì„ ì¡°ì •í•˜ë©´ì„œ contentì— ì¤‘ì ì„ ë‘˜ì§€ styleì— ì¤‘ì ì„ ë‘˜ì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ ì„œë¡œ trade-off ê´€ê³„ì´ë‹¤.


<br>



## Initialization of gradient descent

![12](https://user-images.githubusercontent.com/96368476/153042085-ec98d672-c94e-4ad9-b0fa-85ed1f2e81a4.jpg)
{: width="60%" height="70%"}

- ì›ë˜ noise imageë¥¼ inputìœ¼ë¡œ ë‘ê³  ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ì‹ì´ì—ˆëŠ”ë°, content image ë˜ëŠ” style imageë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë‘¬ë„ ê´œì°®ë‹¤ê³  í•œë‹¤.
- Aê°€ content imageë¥¼ inputìœ¼ë¡œ ë‘” ê²°ê³¼
- Bê°€ style imageë¥¼ inputìœ¼ë¡œ ë‘” ê²°ê³¼ì´ë‹¤.



<br>



## Photorealistic style transfer

![14](https://user-images.githubusercontent.com/96368476/153044603-20cbc839-a7de-4679-b71c-a7670b88ef67.jpg)
{: width="60%" height="70%"}

- Artistic styleì´ ì•„ë‹Œ arbitrary imageë¡œë„ style transferê°€ ê°€ëŠ¥í• ê¹Œ?
- ì˜ˆì™¸ì ì¸ ê²½ìš°ê°€ ì•„ë‹ˆë©´ í˜ë“¤ë‹¤ê³  í•¨
- í•´ìƒë„ê°€ ë†’ìœ¼ë©´ ì„±ëŠ¥ì´ ëª» ë”°ë¼ê°
- noiseê°€ ë§ì´ ë‚Œ
  - ê²½ê³„ê°€ ì• ë§¤í•œ art styleì—ì„œëŠ” ê´œì°®ì•˜ìŒ
  - photorealistic styleì—ì„œëŠ” ë¬¸ì œê°€ ë¨




<br>



# ğŸš€ Discussion

ì €ìë“¤ì´ ì œì‹œí•œ ìŠ¤íƒ€ì¼(feature mapë“¤ì˜ ìƒê´€ê´€ê³„)ì˜ ì •ì˜ëŠ” ì™„ë²½í•˜ì§€ ì•Šë‹¤. ê³ íì˜ 'ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤' styleì„ ì˜ˆë¡œ ë“¤ì–´ë³´ì. ì‚¬ëŒì´ ë³´ê¸°ì— ê·¸ë¦¼ì˜ 'ë³„'ì€ ìŠ¤íƒ€ì¼ì´ ì•„ë‹Œ objectì´ë‹¤. í•˜ì§€ë§Œ style transferì—ì„œëŠ” ë³„ì„ ìŠ¤íƒ€ì¼ë¡œ ì¸ì‹í•œë‹¤. ì•„ì§ ë°œì „í•´ì•¼í•  ì¼ì´ ë‚¨ì•„ìˆë‹¤. ì¸ê°„ì´ ì§±ì´ë‹¤.






<br>



# ğŸš€ ì‹¤ìŠµ

**[Tutoral Code](https://github.com/inhopp/ML_code/blob/main/Style_Transfer_tutorial.ipynb)**
{: .notice--primary}

ì¼ë³¸ ì—¬í–‰ì— ì¢‹ì€ ê¸°ì–µì´ ë§ì•„ì„œ, ì¼ë³¸ í’ê²½ìœ¼ë¡œ tutoral ì½”ë“œë¥¼ ëŒë ¤ë´¤ë‹¤. tensorflow, pytorch ë‘ ë²„ì „ìœ¼ë¡œ í•´ë´¤ëŠ”ë° pytorchê°€ ë” ì§ê´€ì ìœ¼ë¡œ ë³´ê¸° í¸í–ˆë‹¤. ê·¸ë¦¬ê³  gpu ë§ì´ ì“°ë‹ˆê¹Œ ì½”ë©ì—ì„œ ëª»ì“°ê²Œ ë§‰ë”ë¼.

![paper1-23](https://user-images.githubusercontent.com/96368476/153046444-7823543b-bca8-4ec9-8bb6-3a589b671fa8.jpg)
![paper1-24](https://user-images.githubusercontent.com/96368476/153046457-0911275b-3a3b-4c76-b58c-46c88717f27b.jpg)





<br>


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
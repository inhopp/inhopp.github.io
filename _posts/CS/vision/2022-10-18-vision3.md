---
title:  "[CV] Harris Corner Detection" 

categories:
  -  Vision
tags:
  - [CS]

toc: true
toc_sticky: true

date: 2022-10-18
last_modified_at: 2022-10-18
---

<br>

# ğŸ“¹ What is corner?

![corner](https://user-images.githubusercontent.com/96368476/196334721-06ca080a-f9c8-4f43-957b-ad900bedef52.png){: width="60%" height="70%" .align-center}

Cornerë¥¼ ì–´ë–»ê²Œ ì •ì˜í•´ì•¼ í• ê¹Œ? ì‚¬ì‹¤ Harris corner detectorëŠ” ë„ˆë¬´ ëŠë¦¬ê¸° ë•Œë¬¸ì— í˜„ì¬ì—ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë¼ê³  í•œë‹¤. í•˜ì§€ë§Œ Harrisê°€ ì œì•ˆí•œ cornerì˜ ìˆ˜í•™ì  ì •ì˜, ì´ë¥¼ ìˆ˜í•™ì ìœ¼ë¡œ íƒì§€í•  ìˆ˜ ìˆëŠ” ì•Œê³ ë¦¬ì¦˜ì€ ì•„ì£¼ ì¸ìƒì ì´ë‹¤. HarrisëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ flat/edge/cornerë¥¼ êµ¬ë¶„í•˜ì˜€ë‹¤.

- flat : í•œ ì ì— ëŒ€í•´ì„œ, ëª¨ë“  ë°©í–¥ì— ëŒ€í•´ ë³€í™”ëŸ‰ì´ ì‘ë‹¤.
- edge : í•œ ë°©í–¥ìœ¼ë¡œë§Œ ë³€í™”ëŸ‰ì´ ì‘ë‹¤.
- corner : ëª¨ë“  ë°©í–¥ìœ¼ë¡œì˜ ë³€í™”ëŸ‰ì´ í¬ë‹¤.


<br>


# ğŸ“¹ Mathematics of Harris Detector

ì •ë¦¬í•˜ìë©´ cornerë¥¼ ì°¾ê¸° ìœ„í•´ì„œëŠ” í•œ ì ì— ëŒ€í•´ ì£¼ë³€ìœ¼ë¡œì˜ ë³€í™”ëŸ‰ì„ ê³„ì‚°í•´ì•¼ í•œë‹¤. ì´ëŠ” windowë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ë‹¨íˆ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. í•µì‹¬ì€ ì–´ëŠ ë°©í–¥ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ë³€í•˜ëƒëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ ìœ„í•´ ë³€í™”ëŸ‰ í•¨ìˆ˜ë¥¼ 1ì°¨ Taylor seriesë¡œ ê·¼ì‚¬í•˜ê³ , ëŒ€ê°í™”ë¥¼ ì§„í–‰í•œë‹¤. (ëŒ€ê°í™”ì— ëŒ€í•´ì„œëŠ” ì„ í˜•ëŒ€ìˆ˜ í¬ìŠ¤íŒ…ì— ì˜ ì •ë¦¬ë˜ì–´ ìˆë‹¤.) 

<br>

$$ E(u,v) = \sum_{(x,y)\in W}^{}\begin{bmatrix} I(x+u, y+v) - I(x,y)\end{bmatrix}^{2} $$

<br>

$$ \begin{align*} 
I(x+u, y+v) &= I(x,y) + \frac{\partial I}{\partial x} u + \frac{\partial I}{\partial y} v + \textit{higher order term...} \\ &\approx I(x,y) + \frac{\partial I}{\partial x} u + \frac{\partial I}{\partial y} v \\ &= I(x,y) + \begin{bmatrix}I_{x} \, I_{y}\end{bmatrix}\begin{bmatrix} u \\v \end{bmatrix}
\end{align*} $$

<br>

$$ \begin{align*}
E(u,v) &\approx \sum_{(x,y)\in W}^{}\begin{bmatrix} I(x,y) + \begin{bmatrix}
I_{x} & I_{y} \end{bmatrix}\begin{bmatrix} u \\ v \end{bmatrix}
- I(x, y)
\end{bmatrix}^{2} \\ 
&= \sum_{(x,y) \in W}^{} \begin{bmatrix} \begin{bmatrix}
I_{x} & I_{y} \end{bmatrix} \begin{bmatrix} u \\ v \end{bmatrix}
\end{bmatrix}^{2} \\
&= \sum_{(x,y) \in W}^{} \begin{bmatrix} u & v \end{bmatrix} \begin{bmatrix}
I_{x}^{2} & I_{x} I_{y} \\ I_{y} I_{x} & I_{y}^{2} \end{bmatrix}
\begin{bmatrix} u \\ v \end{bmatrix} \\
&= \begin{bmatrix} u & v \end{bmatrix} 
\left ( \sum_{(x,y) \in W}^{} \begin{bmatrix}
I_{x}^{2} & I_{x} I_{y} \\
I_{y} I_{x} & I_{y}^{2} \\
\end{bmatrix} \right )
\begin{bmatrix} u \\ v \end{bmatrix} \\
&= \begin{bmatrix} u & v \end{bmatrix} 
\mathbf{M}
\begin{bmatrix} u \\ v \end{bmatrix}
\end{align*} $$

<br>

ì¦‰, (u,v)ì—ì„œì˜ ë³€í™”ëŸ‰ì€ matrix Mì— ì˜í•´ ê²°ì •ëœë‹¤. ì´ë•Œ ì£¼ëª©í•  ì ì€ Mì´ symmetric í•˜ê¸° ë•Œë¬¸ì— ëŒ€ê°í™”ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì´ê³ , Mì˜ eigen valueì— ë”°ë¼ ì„ì˜ì˜ ë°©í–¥ì— ëŒ€í•œ ë³€í™”ìœ¨ì´ ê²°ì •ëœë‹¤. <br>

$$ \begin{align*}
\mathbf{M} &= \sum_{(x,y) \in W}^{} \begin{bmatrix}
I_{x}^{2} & I_{x} I_{y} \\ I_{y} I_{x} & I_{y}^{2} 
\end{bmatrix} \\
&= X \begin{bmatrix}
\lambda_{1} & 0 \\ 0 & \lambda_{2} 
\end{bmatrix}
X^{T}
\end{align*} $$

<br>

![eigenvalue](https://user-images.githubusercontent.com/96368476/196435479-d965456b-51be-45ad-a0eb-92dc7eb5cd8b.png)
{: width="60%" height="70%" .align-center}

- Î»1 & Î»2ê°€ ëª¨ë‘ ì‘ìŒ : ëª¨ë“  ë°©í–¥ìœ¼ë¡œì˜ ë³€í™”ìœ¨ì´ ì‘ìŒ â†’ Flat
- Î»1ê³¼ Î»2 ì¤‘ í•˜ë‚˜ëŠ” í¬ê³  í•˜ë‚˜ëŠ” ì‘ìŒ : íŠ¹ì • ë°©í–¥ì˜ ë³€í™”ìœ¨ì´ ì‘ìŒ â†’ Edge
- Î»1 & Î»2ê°€ ëª¨ë‘ í¼ : ëª¨ë“  ë°©í–¥ìœ¼ë¡œì˜ ë³€í™”ìœ¨ì´ í¼ â†’ Corner

<br>

## R score

ìš°ë¦¬ê°€ í•„ìš”í•œ ê±´ Î»1ê³¼ Î»2ì˜ êµ¬ì²´ì ì¸ ê°’ì´ ì•„ë‹ˆë¼, ëŒ€ëµì ì¸ í¬ê¸°ì™€ ë¹„ìœ¨ì´ë‹¤. ë”°ë¼ì„œ Determinantì™€ Traceì˜ ì„±ì§ˆì„ ì´ìš©í•˜ë©´ ì§ì ‘ ëŒ€ê°í™”ë¥¼ í•˜ì§€ ì•Šê³ ë„ ê°„í¸íˆ êµ¬í•  ìˆ˜ ìˆë‹¤.

$$ \mathbf{R} = det (M) - k(trace M)^{2} \\ 
\begin{align*}
\textit{where} \quad det(M) &= \lambda_{1} \lambda_{2} \\
trace(M) &= \lambda_{1} + \lambda_{2}
\end{align*} $$

- k = 0.04 ~ 0.06
- If only one of Î»1 or Î»2 is large: det(M) â†“, Râ†“ -> Not a corner
- If both Î»1 and Î»2 are large: det(M) â†‘, Râ†‘ -> Corner


<br>

## Non-max suppression

![nms](https://user-images.githubusercontent.com/96368476/196445146-114fdbd2-ba21-4e9c-8bdf-70eb21135644.png){: width="70%" height="80%" .align-center}

R scroeê°€ íŠ¹ì • ê°’ ì´ìƒì¸ ì ì„ ë½‘ëŠ” ë°©ì‹ìœ¼ë¡œ Cornerë¥¼ íƒì§€í•œë‹¤ê³  í•˜ë©´, í•˜ë‚˜ì˜ cornerë¥¼ ì—¬ëŸ¬ í”½ì…€ì—ì„œ ë™ì‹œì— íƒì§€í•˜ê²Œ ë  ê²ƒì´ë‹¤. ë”°ë¼ì„œ ì¤‘ë³µëœ íƒì§€ë¥¼ ì œê±°í•˜ê¸° ìœ„í•´ NMS ì•Œê³ ë¦¬ì¦˜ì„ ìˆ˜í–‰í•œë‹¤.
ì•Œê³ ë¦¬ì¦˜ì˜ ì‘ë™ ë°©ì‹ì€ í˜„ì¬ í”½ì…€ì—ì„œì˜ R scoreê°’ì´ ì£¼ë³€ì˜ R scoreë³´ë‹¤ í´ ë•Œì—ë§Œ ê°’ì„ ìœ ì§€í•˜ê³ , ë§Œì•½ ì‘ë‹¤ë©´ 0ìœ¼ë¡œ ë§Œë“¤ì–´ R scoreë¥¼ ì••ì¶•í•œë‹¤.


<br>


# ğŸ“¹ Harris Corner Detector Algorithm

1. Compute gradients for all pixels
2. For each pixel, compute M matrix and R socre
3. Find points with R > threshold
4. Non-max suppression



<br>


# ğŸ“¹ About Affine Transforms

![rotation](https://user-images.githubusercontent.com/96368476/196452125-141fbd59-6f90-4781-81e8-a36323f44460.png){: width="60%" height="70%" .align-center}

Affine Transfromì´ë€ ê°„ë‹¨íˆ ë§í•´ (translation + rotation) ë³€í™˜ì´ë‹¤. Harris corner detectorëŠ” Affine transformì— invariant í• ê¹Œ? ì •ë‹µì€ ê·¸ë ‡ë‹¤. Translationì€ ë‹¹ì—°íˆ invariantí•˜ê³ , rotation ë˜í•œ eigen vectorì˜ ë°©í–¥ë§Œ ë°”ë€” ë¿ eigen valuesì˜ ë¹„ìœ¨ì€ ë³€í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

<br>


# ğŸ“¹ About Scaling

| Problem | Solution |
|:-:|:-:|
|![scale_problem](https://user-images.githubusercontent.com/96368476/196459870-42ad1ecc-8757-474b-ae98-3776b68ce51f.png)|![scale](https://user-images.githubusercontent.com/96368476/196461402-fc1e3e7d-9d79-4d7d-b926-fe0ab9364ba2.png)|


Harris DetectorëŠ” scalingì—ë„ invariantí• ê¹Œ? ë‹¤ì‹œ ë§í•´ cornerì˜ ì‚¬ì´ì¦ˆê°€ ë‹¬ë¼ì ¸ë„ ê°™ì€ detector(same window, smae threshold)ë¡œ íƒì§€ê°€ ê°€ëŠ¥í• ê¹Œ? ì •ë‹µì€ ì‘ ì•„ë‹ˆì•¼. í° ì‚¬ì´ì¦ˆì˜ ì½”ë„ˆë¥¼ íƒì§€í•  ë•Œ ì‚¬ì´ì¦ˆê°€ ì‘ì€ detectorë¥¼ ì‚¬ìš©í•  ê²½ìš° ì§ì„ ìœ¼ë¡œ íƒì§€í•  ê°€ëŠ¥ì„±ì´ í¬ê¸° ë•Œë¬¸ì´ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” detectorì˜ ì‚¬ì´ì¦ˆë¥¼ ë°”ê¿”ê°€ë©° R scoreë¥¼ êµ¬í•˜ê³  ê·¸ ì¤‘ ìµœëŒ€ê°’ì„ êµ¬í•´ì•¼ í•œë‹¤. ê°€ëŠ¥ì€ í•˜ì§€ë§Œ ë„ˆë¬´ ë²ˆê±°ë¡œìš´ ì‘ì—…ì´ë‹¤. ì´ ì§€ì ì´ ë°”ë¡œ harris detectorì˜ í•œê³„ì´ê³ , Scale Invariant Feature Transform(SIFT)ì˜ ë“±ì¥ ë°°ê²½ì´ë‹¤.

<br>


# ğŸ“¹ Results

![harris_result](https://user-images.githubusercontent.com/96368476/196448239-8f783344-5865-4d80-bf1f-d345ff6f44d2.jpeg){: width="70%" height="80%" .align-center}



<br>




[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
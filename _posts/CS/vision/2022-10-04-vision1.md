---
title:  "[CV] Seam Carving for Content-Aware Image Resizing" 

categories:
  -  Vision
tags:
  - [CS]

toc: true
toc_sticky: true

date: 2022-10-04
last_modified_at: 2022-10-04
---

**Main Reference: <br>- [CONTENT-AWARE IMAGE RESIZING - TREKHLEB](https://trekhleb.dev/blog/2021/content-aware-image-resizing-in-javascript/)**
{: .notice--warning}


<br>

# ğŸ“¹ Seam carving

| Original | Content-aware | standard |
|:-:|:-:|:-:|
|![mountain](https://user-images.githubusercontent.com/96368476/193777598-3012fef7-d7a4-4b87-a3e5-5e12ea281e30.png)|![mountain1](https://user-images.githubusercontent.com/96368476/193777617-59011fd4-b164-46b0-8d5b-a66b75abf686.png)|![mountain2](https://user-images.githubusercontent.com/96368476/193777625-42d5617f-47ef-464a-98b0-192c020ac6ca.png)|

Seam carving algorithmì˜ mian ideaëŠ” ì´ë¯¸ì§€ë¥¼ resizeí•  ë•Œ ë‹¨ìˆœ ë¹„ìœ¨ë¡œ resizeí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ interesting contents ë¶€ë¶„ì„ ë³´ì¡´í•˜ë©° resizeí•˜ìëŠ” ê²ƒì´ë‹¤. ìœ„ ê·¸ë¦¼ì€ 636x437 ì´ë¯¸ì§€ì—ì„œ ë†’ì´ ë°©í–¥ 50 í”½ì…€ì„ ì œê±°í•œ ê·¸ë¦¼ì´ë‹¤. ì˜¤ë¥¸ìª½ ë‘ ê·¸ë¦¼ ì¤‘ ì²« ë²ˆì§¸ëŠ” seam carving algorithmì„ ì´ìš©í•œ contetn-aware resize, ë‘ ë²ˆì§¸ëŠ” standard resizeí•œ ê²ƒì´ë‹¤. Content-aware resizeí•œ ê·¸ë¦¼ì„ ë³´ë©´ contentsì¸ ì‚°ì€ ë³€í™”ê°€ ì—†ê³  ë°°ê²½ ë¶€ë¶„ë§Œ ì˜ë ¤ ë‚˜ê°„ ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤. <br>


Seam carving algorithmì€ ê°„ë‹¨í•˜ê²Œ ë‹¤ìŒ ë‹¨ê³„ë¡œ êµ¬ì„±ëœë‹¤.

1. Compute energy map of iamge 
    - imageì˜ energy map êµ¬í•˜ê¸°
2. Find the seam with the lowest energy based on energy map (with dynamic programming)
    - energy mapì„ ê¸°ë°˜ìœ¼ë¡œ ê°€ì¥ íš¨ìœ¨ì ì¸ ê²½ë¡œ êµ¬í•˜ê¸°
3. Remove the seam from the image
    - imageì—ì„œ ì°¾ì€ ê²½ë¡œ ì œê±°
4. Repeat until the image width is reduced to the desired value.
    - í•„ìš”í•œ ë§Œí¼ ìœ„ ê³¼ì •ì„ ë°˜ë³µ

<br>


## Compute energy map of iamge

![energy_map](https://user-images.githubusercontent.com/96368476/193759390-89c9dec1-8116-40ec-9518-91d5636864f2.png){: width="60%" height="70%" .align-center}

$$ dx = \begin{bmatrix}
1 & 0 & -1 \\
2 & 0 & -2 \\
1 & 0 & -1 \\
\end{bmatrix}

\textbf{    ,   }

dy = \begin{bmatrix}
1 & 2 & 1 \\
0 & 0 & 0 \\
-1 & -2 & -1 \\
\end{bmatrix}  $$

$$ \textbf{Energy}\left ( \textbf{f} \right ) = \sqrt{\left ( \frac{\partial f}{\partial x} \right )^{2} + \left ( \frac{\partial f}{\partial y} \right )^{2}} $$

- rgb ì´ë¯¸ì§€ë¥¼ gray ì´ë¯¸ì§€ë¡œ ë³€í™˜
- sobel operatorë¥¼ ì´ìš©í•´ dx & dy ê³„ì‚°
- energy map êµ¬í•˜ê¸°


<br>

## Find the seam with the lowest energy based on energy map (with dynamic programming)

![cumulate_map](https://user-images.githubusercontent.com/96368476/193763060-a191f461-60b5-42fb-adb6-388640f0ff61.png){: .align-center}

<br>

$$ \textbf{M}\left ( i, j \right ) = \textbf{Energy}\left ( i, j \right ) + min\left ( \textbf{M}\left ( i-1, j-1 \right ), \textbf{M}\left ( i-1, j \right ), \textbf{M}\left ( i-1, j+1 \right ) \right ) $$

<br>

- ì£¼ì–´ì§„ Energy mapì„ ê¸°ë°˜ìœ¼ë¡œ cumulative minimum energy map ê³„ì‚°
    - ì„¸ë¡œ í”½ì…€ ì¤„ì¼ ë•Œì—ëŠ” ìœ„ì—ì„œ ì•„ë˜ë¡œ cumulate
    - ê°€ë¡œ í”½ì…€ ì¤„ì¼ ëŒ€ì—ëŠ” ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ cumulate
- ë§ˆì§€ë§‰ row(column)ì—ì„œ ê°€ì¥ ì‘ì€ energy ê²½ë¡œ backtracking

<br>

![seam](https://user-images.githubusercontent.com/96368476/193759394-b82071df-2f63-4615-bb79-b7e5edbbeeb5.png)

- ì‚° ì´ë¯¸ì§€ì˜ ê²½ìš° ë§¨ ìœ„ í•˜ëŠ˜ ë°°ê²½ ë¶€ë¶„ì´ seamìœ¼ë¡œ ì„ íƒëœë‹¤.
- ì›ë³¸ ì´ë¯¸ì§€ì—ì„œ í•´ë‹¹ seam ë¶€ë¶„ì„ ì œê±°
- ìœ„ ê³¼ì •ì„ ë°˜ë³µ


<br>


# ğŸ“¹ Results

| Original | Content-aware | standard |
|:-:|:-:|:-:|
|![balloon](https://user-images.githubusercontent.com/96368476/193771800-ca87fcae-b5f0-484b-a0b5-e407ced6d3a8.jpeg)|![balloon1](https://user-images.githubusercontent.com/96368476/193771816-7cca601f-0675-4e65-9d81-be87c88b962b.png)|![balloon2](https://user-images.githubusercontent.com/96368476/193771814-15f427a8-42ef-4fee-a926-93e5aa90a512.png)|


<br>

> êµ¬ê¸€ë§ í•˜ë‹¤ê°€ ì°¾ì€ ì¬ë¯¸ìˆëŠ” ì˜ˆì œ. contents masking ì´í›„ seam carving ì§„í–‰í–ˆë‹¤ê³  í•œë‹¤. <br>**Reference: https://github.com/andrewdcampbell/seam-carving**

| Original | Content-aware resize |
|:-:|:-:|
|![ratatouille](https://user-images.githubusercontent.com/96368476/193772596-db324ed2-e01e-442e-9a1b-d68d4e61b05a.jpeg)|![ratatouille_resize](https://user-images.githubusercontent.com/96368476/193772609-8e25cb6a-1140-4ae0-bddc-b264d27d4937.jpeg)|


![ratatouille](https://user-images.githubusercontent.com/96368476/193774936-51309070-3305-4527-a547-643b83c13ee4.gif)



<br>



[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
---
title:  "[그래픽스 최적화] Shadow Map" 

categories:
  -  Unity
tags:
  - [Optimization]

toc: true
toc_sticky: true

date: 2023-05-03
last_modified_at: 2023-05-03
---


**Main Reference: <br>- [유니티 그래픽스 최적화](https://product.kyobobook.co.kr/detail/S000001888125)**
{: .notice--warning}

<br>

# 🐳 Shadow Map

![image11](https://user-images.githubusercontent.com/96368476/235971820-fa0a1dd6-70e9-46cd-b923-9680ad1d2f07.png){: width="60%" height="70%"}

라이팅의 요소 중 하나인 그림자는 사실적인 그래픽을 표현할 때 매우 중요하다. 불행히도 그림자는 직접 렌더링 할 수 없고, 광원과 오브젝트들의 상호작용을 통해 만들어지는 매우 비싼 연산이다. 하지만 그림자의 특성 상 아주 구체적일 필요는 없다. 그렇기에 정확도를 조금 손해보더라도 최대한 성능을 끌어올리는 이런저런 최적화 기법도 존재한다.


<br>

| Shadow | Shadow Map |
|:-:|:-:|
|![shadow](https://user-images.githubusercontent.com/96368476/235975526-8bdca76e-8531-4563-9bc3-21352e99784d.png)|![images](https://user-images.githubusercontent.com/96368476/235972537-40687846-ed52-4836-9ace-c2d9f487e575.jpeg)|  

먼저 그림자를 구현하는 방법에 대해 알아보자. 그림자를 구현하기 위해서는 앞서 G-Buffer에서 다룬 depth map과 새롭게 등장할 shadow map이 필요하다. Depth map이 카메라로부터 각 픽셀까지의 거리를 뜻한다면, shadow map은 광원으로부터 각 픽셀까지의 거리를 뜻한다. 이제 각 픽셀의 world 좌표와, depth 정보를 통해 픽셀과 광원 사이의 거리를 구할 수 있다. Depth map을 통해 구한 거리와 shadow map을 이용해 구한 거리가 다르면 그림자가 생겨야 할 지점인 것이다. <br>따라서 그림자를 구현하기 위해서 shadow map이 필요한데, shadow map이란 결국 main directional light(가장 빛이 센 directional light)을 카메라로 취급해 depth map을 하나 더 그리는 것이다. 따라서 프레임버퍼만한 버퍼가 추가적으로 필요하고 드로우콜도 거의 두배로 늘어난다. 그림자 연산이 비싼 이유이다.

<br>

![setting](https://user-images.githubusercontent.com/96368476/235981326-74138ec6-ec9b-485d-91f7-fe813e3ce62e.png)

그림자 연산을 효율적으로 하기 위해서는 mesh별로 존재하는 Cast Shadows 항목을 잘 설정해야 한다. 이 값은 shadow map에 해당 메시를 렌더링 할지말지 결정한다. 따라서 다른 오브젝트에 그림자를 만들 필요가 없는 경우 이 값을 꺼두고 드로우콜을 아껴야 한다. 만약 그림자를 만드는 메시가 아주 무거울 경우, 그림자만을 위한 깡통 메시를 만들고 shadows only 설정을 통해 대신 렌더링할 수 있다.



<br>


# 🐳 Shadow Distance








<br>
<br>


[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}
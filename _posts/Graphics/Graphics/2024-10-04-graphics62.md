---
title:  "Stable Fluids" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2024-10-05
last_modified_at: 2024-10-05
---


홍정모님의 **[그래픽스 새싹코스](https://honglab.co.kr/)** 강의를 듣고 정리한 내용입니다.
{: .notice--warning}

**[Stable Fluids Paper](https://pages.cs.wisc.edu/~chaol/data/cs777/stam-stable_fluids.pdf) <br>[Ten Minute Physics](https://www.youtube.com/watch?v=iKAVRgIrUOU) <br>[Projection method (fluid dynamics)](https://en.wikipedia.org/wiki/Projection_method_(fluid_dynamics)#References)**
{: .notice--primary}

<br>

# Chorin's Projection Method

$$  \frac{\partial u}{\Delta t} = - \left ( u \cdot \bigtriangledown  \right )u - \frac{1}{\rho} p + \nu \bigtriangledown ^{2} u $$

Stable Fluid 역시 SPH와 동일하게 Incompressible한 Navier-Stokes 방정식을 푸는 컨셉이다. 차이점이라 한다면 SPH는 Particle의 속도와 압력을 직접 계산해 수정하는 방식이었지만, Stable Fluid에서는 공간의 그리드 셀 마다 속도와 압력을 가지고 있으며 해당 Vector Field를 업데이트하는 방식이다. 또한 방정식을 푸는 방법도 다른데 Stable Fluid에서는 Chorin이라는 수학자가 제시한 Projection Method라는 방식을 이용한다. (수학과 만세..)

<br>

$$ (1) \quad \frac{u^{*} - u^{n}}{\Delta  t} = - \left ( u \cdot \bigtriangledown  \right )u + \nu \bigtriangledown ^{2} u^{n} $$

$$ (2) \quad u^{n+1} = u^{*} - \frac{\Delta t}{\rho} \bigtriangledown p^{n+1} $$

- n번째 스텝에서 바로 n+1번째 스텝으로 가는 것이 아니라 중간 스텝(u*)을 먼저 구함
- 이때 u*를 구하는 과정은 Navier-Stokes식에서 압력 p 텀을 무시한 형태
- (1)에서 구한 u*를 이용해 n+1번째 스텝 계산
- 여기서 문제는 압력 p텀을 알아야 하는데, Incompressible 조건을 이용해 아래와 같이 구할 수 있음

<br>

$$ u^{n+1} - u^{*} = - \frac{\Delta t}{\rho} \bigtriangledown p^{n+1} $$

$$ \bigtriangledown  \left (u^{n+1} - u^{*} \right ) = - \frac{\Delta t}{\rho} \bigtriangledown^{2} p^{n+1} $$

$$ - \bigtriangledown u^{*}  = - \frac{\Delta t}{\rho} \bigtriangledown^{2} p^{n+1} \quad \left ( \because  \bigtriangledown u^{n+1} = 0 \right ) $$

$$ \bigtriangledown^{2} p^{n+1} = \frac{\rho}{\Delta t} \bigtriangledown \cdot u^{*} $$

- Incompressible 하나는 것은 Divergence가 0이라는 의미!
- 이렇게 구한 p를 이용해 u의 n+1 스텝을 계산


<br>

| Grid Texture | FDM |
|:-:|:-:|
|![054336](https://github.com/user-attachments/assets/1bccbc77-0566-4b1f-b657-82db76b3d140)|![74-Table4 1-1](https://github.com/user-attachments/assets/1fb845b0-2439-44aa-9a54-543be1efe4a9)|

- 미분 관련 연산은 모두 FDM 방식을 이용해 계산
- 이때 각 그리드 셀의 속도, 압력 벡터들을 텍스처 형태로 들고다니면 매우매우 편리해짐
  - 속도의 경우 그리드 셀 가운데 하나만 정의해도 괜찬흥ㅁ
  - 반면 압력의 경우 그리드 셀의 모서리마다 벡터가 정의되어야 내부의 변화량을 측정할 수 있음


<br>

# Algorithm





<br>
<br>


[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}
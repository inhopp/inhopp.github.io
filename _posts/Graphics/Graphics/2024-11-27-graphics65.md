---
title:  "Smoke Simulation" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2024-11-27
last_modified_at: 2024-11-27
---


홍정모님의 **[그래픽스 새싹코스](https://honglab.co.kr/)** 강의를 듣고 정리한 내용입니다.
{: .notice--warning}

<br>

# Smoke Simulation

$$  \frac{\partial u}{\Delta t} = - \left ( u \cdot \bigtriangledown  \right )u - \frac{1}{\rho} p + \nu \bigtriangledown ^{2} u $$

``` c++
void StableFluids::Update() {
    // ...

    Sourcing(context);
    Advection(context);
    Diffuse(context);
    Projection(context);
}
```

- `Sourcing` : External Forces 계산 (예제에서는 마우스의 속도, 그리드 셀의 컬러)
- `Advection` : Velocity Field 업데이트 (유체가 스스로를 이동시키며 내부 상태 변화)
- `Diffuse` : viscosity(점성) 효과를 적용해 값이 퍼짐
- `Projection` : pressure(압력) 계산 (유체가 비압축성 성질을 갖도록 압력 보정)

Stable Fluids예제를 간단히 복습하면 Navier-Stokes 방정식을 위 방식으로 풀었고, pixel shader에서는 단순히 해당 픽셀의 density값을 가져와 사용했었다. 여기서 조금만 더 응용하면 smoke simulation을 구현할 수 있다. 바로 Stable Fluid를 이용해 유체의 흐름을 계산하고, Cloud Rendering에서 사용한 lighting 계산을 이용해 color를 결정하는 방법이다. 단순 Density를 이용하는 것이 아닌 Beer's law를 이용해 빛을 감쇠시키고, HenyeyGreenstein 함수를 적용해 color를 지정하면 된다.

<br>

| No Object | Add Object | Boundary Conditions |
|:-:|:-:|:-:|
|![053607](https://github.com/user-attachments/assets/c52e9cbd-e845-4dce-83bb-f75df2d30994)|![052658](https://github.com/user-attachments/assets/600c8421-e211-458f-ace9-e595f1e70ef9)|![KakaoTalk_20241127_052211020](https://github.com/user-attachments/assets/8c7c70c5-54ef-4474-9408-8c2dad6d1f24)|

유체 중간에 object를 두게되면 와류가 발생해 훨씬 자연스러운 연기 효과가 표현된다. 하지만 이를 구현하기 위해서는 추가적인 세팅(boundary condition)이 필요하다.

- Dirichlet Condition : 전체 경계 부분에서 사용
    - 속도 값을 상수로 고정 (압력을 0으로 세팅)
- Neumann Condition : 내부 오브젝트와의 경계에서 사용
    - 속도의 변화율을 상수(0)로 고정 (flux = 0)
    - 오브젝트 경계 외부와 내부의 압력 크기를 같게 세팅(부호만 반대로)


<br>

# DownSampling


<br>


# Sourcing


<br>

# Projection


<br>


# Diffuse & UpSampling



<br>


# Advection







<br>
<br>


[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}
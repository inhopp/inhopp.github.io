---
title:  "Tesselation" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2023-09-02
last_modified_at: 2023-09-02
---


í™ì •ëª¨ë‹˜ì˜ **[ê·¸ë˜í”½ìŠ¤ ìƒˆì‹¹ì½”ìŠ¤](https://honglab.co.kr/)** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
{: .notice--warning}

<br>


# ğŸ¥ Tesselation

| Rendering Pipeline | Control Points |
|:-:|:-:|
|![1](https://github.com/inhopp/PGGAN/assets/96368476/2cc9d2dd-4f00-4464-a1cd-2bf8fdbf3084)|![2](https://github.com/inhopp/StyleGAN/assets/96368476/ac53bdd6-f535-4218-85d1-ea50c5cc0244)| 

ê·¸ë˜í”½ìŠ¤ì—ì„œ ê³¡ë©´ì„ ë‹¤ë£¨ëŠ” ë°©ì‹ì€ ì˜¤ë¥¸ìª½ ê·¸ë¦¼ê³¼ ê°™ì´ control pointë“¤ë¡œ ì´ë£¨ì–´ì§„ íŒ¨ì¹˜ë“¤ì„ ì´ìš©í•œ ë°©ì‹ì´ë‹¤. ì´ëŸ¬í•œ íŒ¨ì¹˜ë“¤ì„ ë‹¤ë£¨ëŠ” ë‹¨ê³„ê°€ ë°”ë¡œ ê»ë°ê¸°ë¼ëŠ” ì˜ë¯¸ë¥¼ ê°€ì§„ Hull Shader ë‹¨ê³„ì´ë‹¤. Hull Shaderë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” primitive topologyë¥¼ control_point_patchlistë¡œ ì§€ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.  

<br>


# ğŸ¥ Hull Shader

![d3d11-hull-shader](https://github.com/inhopp/StyleGAN/assets/96368476/1d7b426d-e39e-4208-a48c-0922722af936){: width="60%" height="70%"}

``` hlsl
struct Hullout
{
    float3 pos : POSITION;
}

struct PatchConstOutput
{
    float edges[4] : SV_TessFactor;
    float inside[2] : SV_InsideTessFactor;
}

PatchConstOutput MyPatchConstantFunc(InputPatch<VertexOut, 4> patch, uint patchID : SV_PrimitiveID)
{
    PatchConstOutput pt;

    // tesselation ë‹¨ê³„
    pt.edges[0] = 1; 
    pt.inside[0] = 1;
    // ...

    return pt
}


[domain("quad")]
[partitioning("Integer")]
[outputtopology("triangle_cw")]
[outputcontrolpoints(4)]
[patchconstantfunc("MyPatchConstantFunc")]
[maxtessfactor(64.0f)]
HullOut main(InputPatch<VertexOut, 4> p, uint i : SV_OutputControlPointID, uint patchID : SV_PrimitiveID)
{
    HullOut hout;
    hout.pos = p[i].pos.xyz;

    return hout;
}
```

- Hull ShaderëŠ” 2ê°œì˜ Outputì„ ê°€ì§
    - control points / íŒ¨ì¹˜ ëª‡ ë‹¨ê³„ë¡œ ë‚˜ëˆŒì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
- `[domain("quad")]` : Patch ëª¨ì–‘ì€ ì‚¬ê°í˜•ì´ì•¼
- `[partitioning("Integer")]` : tesselation ë‹¨ìœ„ëŠ” integerì•¼
- `[outputtopology("triangle_cw")]` : output topologyëŠ” ì‹œê³„ë°©í–¥ ì‚¼ê°í˜•ì´ì•¼
- `[outputcontrolpoints(4)]` : ìŠ¤ë ˆë“œë‹¹ ì¶œë ¥ë˜ëŠ” control point ê°¯ìˆ˜
- `[patchconstantfunc("MyPatchConstantFunc")]` : íŒ¨ì¹˜ë¥¼ ëª‡ ë‹¨ê³„ë¡œ ë‚˜ëˆŒì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜ì˜ ì´ë¦„ì€ "MyPatchConstantFunc"
- `[maxtessfactor(64.0f)]` : tesselation ìµœëŒ€ê°’ì€ 64


<br>



# ğŸ¥ Domain Shader

![d3d11-domain-shader](https://github.com/inhopp/StyleGAN/assets/96368476/09b6f8aa-291d-49c4-ab18-ca44c50bf6c8){: width="60%" height="70%"}

``` hlsl
struct DomainOut
{
    float4 pos : SV_POSITION;
}

[domain("quad")]
DomainOut main(PatchConstOutput patchConst, float2 uv : SV_DomainLocation, const OutputPatch<HullOut, 4> quad)
{
    DomainOut dout;

    // bilinear interpolation
    float3 v1 = lerp(quad[0].pos, quad[1].pos, uv.x);
    float3 v2 = lerp(quad[2].pos, quad[3].pos, uv.x);
    float3 p = lerp(v1, v2, uv.y);

    dout.pos = float4(p, 1.0);
    dout.pos = mul(dout.pos, view);
    dout.pos = mul(dout.pos, proj);

    return dout;
}
```

- Domain Shaderì—ì„œëŠ” Hull Shaderì—ì„œ ë°›ì•„ì˜¨ control pointì™€ constant functionìœ¼ë¡œ pixel shaderì— ë„˜ê²¨ ì¤„ ìµœì¢… vertexë“¤ì„ êµ¬í•œë‹¤.
- `SV_DomainLocation` : íŒ¨ì¹˜ ë‚´ì—ì„œì˜ uvì¢Œí‘œ
    - ex) xë°©í–¥ edgeë¥¼ 2ë“±ë¶„ í–ˆë‹¤ë©´ uv.x = 0.5


<br>

# ğŸ¥ Results

> ì „ì²´ boxì™€ì˜ ê±°ë¦¬ì— ë”°ë¼ tesselation ë‹¨ê³„ ì¡°ì ˆ (in Hull shader)

![ezgif com-crop](https://github.com/inhopp/StyleGAN/assets/96368476/5bd7d06f-8bb1-4f6e-bdaf-8c78e7b6507d)





<br>
<br>


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
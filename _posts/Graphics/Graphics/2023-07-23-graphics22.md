---
title:  "High Level Shader Language (HLSL)" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2023-07-23
last_modified_at: 2023-07-23
---


í™ì •ëª¨ë‹˜ì˜ **[ê·¸ë˜í”½ìŠ¤ ìƒˆì‹¹ì½”ìŠ¤](https://honglab.co.kr/)** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
{: .notice--warning}

<br>


# ğŸ¥ Vertex Shader

## Constant Buffer

``` hlsl
// Constant Buffer in CPU
struct ModelViewProjectionConstantBuffer {
    Matrix model;
    Matrix view;
    Matrix projection;
};

static_assert((sizeof(ModelViewProjectionConstantBuffer) % 16) == 0,
              "Constant Buffer size must be 16-byte aligned");

// ...

// Constant Buffer in GPU (Vertex Shader)
cbuffer ModelViewProjectionConstantBuffer : register(b0) {
    matrix model; 
    matrix view;
    matrix projection;
};
```

![1](https://github.com/inhopp/inhopp/assets/96368476/b3c73216-57b3-48ee-8c71-b93981526bad){: width="60%" height="70%"}

- CPUì—ì„œ ë²„í¼ì— ë‹´ëŠ” ë°ì´í„°ì˜ êµ¬ì¡°ì™€ GPUì—ì„œ ë°›ëŠ” ë²„í¼ì˜ ë°ì´í„° êµ¬ì¡°ê°€ ê°™ì•„ì•¼ í•¨
- GPUê°€ì†ì„ ìœ„í•´ ë°ì´í„°ëŠ” 16-byteì˜ ë°°ìˆ˜ë¡œ ì„¤ì •
- Shader ì½”ë“œ ì•ˆì—ì„œ ë²„í¼ê°€ ì–´ë–¤ íƒ€ì…ì˜ ë ˆì§€ìŠ¤í„°ì— ë“¤ì–´ê°€ëŠ”ì§€ ëª…ì‹œí•´ì¤Œ


<br>


## Input/Output Buffer

``` hlsl
// Input Elements in CPU
vector<D3D11_INPUT_ELEMENT_DESC> inputElements = {
    {"POSITION", 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 0,
      D3D11_INPUT_PER_VERTEX_DATA, 0},
    {"COLOR", 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 4 * 3,
      D3D11_INPUT_PER_VERTEX_DATA, 0},
    {"TEXCOORD", 0, DXGI_FORMAT_R32G32_FLOAT, 0, 4 * 3 + 4 * 3,
      D3D11_INPUT_PER_VERTEX_DATA, 0},
};

// Data struct in GPU
struct VertexShaderInput {
    float3 pos : POSITION;
    float3 color : COLOR0;
    float2 texcoord : TEXCOORD0;
};

struct PixelShaderInput {
    float4 pos : SV_POSITION;
    float3 color : COLOR;
    float2 texcoord : TEXCOORD0;
};
```

![2](https://github.com/inhopp/inhopp/assets/96368476/39fd0d0f-bb08-4f48-af5d-b97e4db97edf){: width="60%" height="70%"}

- HLSLì—ì„œëŠ” float3, float4x4, matrix ë“± ì•„ì£¼ ìœ ìš©í•œ ë°ì´í„° íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ(x,y,z,wë¡œ ì ‘ê·¼ ê°€ëŠ¥)
- ì¼ë°˜ì ìœ¼ë¡œ vertex shaderì˜ input/output ë°ì´í„° êµ¬ì¡°ë¥¼ ì •ì˜í•˜ê³  ì‚¬ìš©
- ë³€ìˆ˜ ì˜†ì— Semantics ëª…ì‹œí•´ì•¼ í•¨ (cpuì—ì„œ ì§€ì •í•œ input elementsì™€ ì¼ì¹˜í•´ì•¼ í•¨)

<br>

## Main Function (Kernel)

``` hlsl
// Compile Shader in CPU
HRESULT hr = D3DCompileFromFile(filename.c_str(), 0, 0, "main", "vs_5_0",
                                compileFlags, 0, &shaderBlob, &errorBlob);


// Shader code in hlsl file
PixelShaderInput main(VertexShaderInput input) {

    PixelShaderInput output;
    float4 pos = float4(input.pos, 1.0f);

    pos = mul(pos, model);
    pos = mul(pos, view);
    pos = mul(pos, projection);

    output.pos = pos;
    output.color = input.color;
    output.texcoord = input.texcoord;

    return output;
}
```

- main ë©”ì„œë“œì˜ ì´ë¦„ì€ cpuì—ì„œ shader compileí•  ë•Œ í‘œê¸°í•œ ì´ë¦„ê³¼ ë§ì•„ì•¼ í•¨
- ì•ì„œ ì •ì˜í•œ input/output êµ¬ì¡°ë¡œ ì‘ì„±




<br>


# ğŸ¥ Pixel Shader

``` hlsl
// Constant Buffer in CPU
struct PixelShaderConstantBuffer {
    float xSplit;
    float padding[3];
};


// Pixel Shader (hlsl file)
cbuffer PixelShaderConstantBuffer : register(b0) { float xSplit; }

struct PixelShaderInput {
    float4 pos : SV_POSITION;
    float3 color : COLOR;
    float2 texcoord : TEXCOORD0;
};

float4 main(PixelShaderInput input) : SV_TARGET {

    return input.texcoord.x > xSplit ? float4(0.0, 0.0, 1.0, 1.0)
                                     : float4(1.0, 0.0, 0.0, 1.0);
}
```

- Pixel Shaderì— í•„ìš”í•œ constant buffer ì—­ì‹œ 16-byte ë‹¨ìœ„ë¡œ ë°›ì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì— padding ë³€ìˆ˜ ì¶”ê°€í•´ì„œ ë„˜ê²¨ì¤Œ
- Pixel Shaderì˜ inputì€ vertex shaderì˜ output íƒ€ì…
- DirectXê°€ ì•Œì˜ë”±ì„¼ìœ¼ë¡œ rasterization & Correction Interpolation í•´ì¤Œ


<br>



# ğŸ¥ Results

![ezgif com-crop](https://github.com/inhopp/inhopp/assets/96368476/cc080b55-bd60-4bd6-8ab8-60e9ea0db106)


<br>
<br>


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
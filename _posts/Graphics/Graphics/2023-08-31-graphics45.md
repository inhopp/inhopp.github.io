---
title:  "Geometry Shader" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2023-08-31
last_modified_at: 2023-08-31
---


í™ì •ëª¨ë‹˜ì˜ **[ê·¸ë˜í”½ìŠ¤ ìƒˆì‹¹ì½”ìŠ¤](https://honglab.co.kr/)** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
{: .notice--warning}

<br>


# ğŸ¥ Geometry Shader

| Geometry Shader | Subdivision |
|:-:|:-:|
|![1](https://github.com/inhopp/PGGAN/assets/96368476/2cc9d2dd-4f00-4464-a1cd-2bf8fdbf3084)|![2](https://github.com/inhopp/PGGAN/assets/96368476/cb9a13e5-1c59-429a-86ee-2c6d71509587)| 

Geometry ShaderëŠ” Vertex Shaderì™€ Pixel Shader ì¤‘ê°„ì— ì¡´ì¬í•˜ëŠ” shaderì´ë‹¤. ê¸°ì¡´ì˜ vertexë¡œ ìƒˆë¡œìš´ vertexë¥¼ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ”ë°, ëŒ€í‘œì ìœ¼ë¡œ subdivisionê³¼ ê°™ì€ ì—­í• ì„ í•œë‹¤. GPUì˜ ì„±ëŠ¥ì´ ì¢‹ì•„ì§€ë©´ì„œ CPUì˜ ì‘ì—…ì„ GPUë¡œ ëŒì–´ì™”ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤. CPUì—ì„œ ì ì • ìˆ˜ì¤€ì˜ vertexë“¤ì„ ë³´ë‚´ì£¼ë©´, ì„¸ì„¸í•œ ë””í…Œì¼ë“¤ì€ GPUì—ì„œ êµ¬í•˜ëŠ” ê²ƒì´ë‹¤.

<br>

![3](https://github.com/inhopp/PGGAN/assets/96368476/82b53070-797b-4192-8cd5-5d6fb129c93b){: width="60%" height="70%"}

``` hlsl
[maxvertexcount(100)]
void main(point GeometryShaderInput input[1], uint primID : SV_PrimitiveID, inout PointStream<PixelShaderInput> outputStream)
{
    PixelShaderInput output;

    for (int i=0; i<100; i++>)
    {
        output.pos = input[0].pos + float4(0.0, 0.003, 0.0, 0.0) * float(i);
        output.pos = mul(output.pos, view);
        output.pos = mul(output.pos, proj);
        output.primID = primID;

        outputStream.Append(output);
    }
}
```

- ìœ„ ì½”ë“œëŠ” vertex 1ê°œë‹¹ 100ê°œì”©ìœ¼ë¡œ ëŠ˜ë¦¬ëŠ” Shader
- `maxvertexcount(num)` : point í•˜ë‚˜ë¥¼ ëª‡ê°œë¡œ ëŠ˜ë¦´ë˜?
    - ë¬´í•œì • ëŠ˜ë¦¬ì§€ëŠ” ëª»í•˜ê³  32bit 1024ê°œê¹Œì§€
- `point GeometryShaderInput input[1]` : Geometry Shaderë¡œ ë“¤ì–´ì˜¤ëŠ” inputì€ point 1ê°œì”©ì´ì•¼
- `primID` : CPUì—ì„œ ë³´ë‚´ì¤„ ë–„ ì§€ì •í•œ topologyì— ë”°ë¼ 
    - í¬ì¸íŠ¸ í•˜ë‚˜ or ì„ ë¶„ í•˜ë‚˜ or ì‚¼ê°í˜• í•˜ë‚˜ ...
- `inout PointStream<PixelShaderInput> outputStream` : Shaderì˜ return typeì„ ë³´ë©´ voidì´ë‹¤.
    - inout í•œì •ìë¥¼ ì´ìš©í•´ outputStreamì— ì§ì ‘ append í•˜ëŠ” ë°©ì‹
    - output topologyì— ë”°ë¼ PointStream, TriangleStream...

<br>

![geometry_modes](https://github.com/inhopp/PGGAN/assets/96368476/5a58da01-2b2d-43d8-b4ae-b6e52ead340c){: width="60%" height="70%"}

- Geometry Shaderì˜ default topologyëŠ” TranlgeStrip
- ë§Œì•½ TrangleListë¡œ vertexë“¤ì„ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´ 3ê°œì”© appendí•˜ê³ , RestartStrip()ìœ¼ë¡œ ëŠì–´ì£¼ì–´ì•¼ í•¨



<br>
<br>


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}
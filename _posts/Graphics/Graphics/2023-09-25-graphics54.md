---
title:  "Shadow Map (+ PCF, PCSS)" 

categories:
  -  Graphics
tags:
  - [DirectX]

toc: true
toc_sticky: true

date: 2023-09-25
last_modified_at: 2023-09-25
---


í™ì •ëª¨ë‹˜ì˜ **[ê·¸ë˜í”½ìŠ¤ ìƒˆì‹¹ì½”ìŠ¤](https://honglab.co.kr/)** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
{: .notice--warning}

<br>


# ğŸ¥ Shadow Map

![Ect-68](https://github.com/inhopp/StyleGAN/assets/96368476/c90364e7-6f95-4a3f-8ee8-dd97ec2d560a){: width="40%" height="50%"}

Rasterizationì„ ì´ìš©í•œ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ì—ì„œ ê·¸ë¦¼ìë¥¼ ê·¸ë¦¬ëŠ” ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- Lightë¡œë¶€í„°ì˜ depth map êµ¬í•˜ê¸° (Shadow map)
- íŠ¹ì • í”½ì…€ì˜ world positionìœ¼ë¡œë¶€í„° lightê¹Œì§€ì˜ ê±°ë¦¬ êµ¬í•˜ê¸°
- ë‘ ê±°ë¦¬ë¥¼ ë¹„êµí•˜ì—¬ ê·¸ë¦¼ì ì˜ì—­ íŒë³„


<br>


![ezgif com-crop (2)](https://github.com/inhopp/StyleGAN/assets/96368476/c6ad97e8-7d8b-45a2-894f-1407d6ca9f71)




<br>

# ğŸ¥ Percentage Closer Filtering (PCF)

![3](https://github.com/inhopp/StyleGAN/assets/96368476/9f34d57a-e71c-4ef7-96d1-bf55ada54a5b){: width="40%" height="50%"}

Shadow Mappingì„ ì´ìš©í•œ ê·¸ë¦¼ìëŠ” í”„ë ˆì„ ë²„í¼ì˜ í•´ìƒë„ê°€ ë†’ì„ ìˆ˜ë¡ í’ˆì§ˆì´ ë–¨ì–´ì§„ë‹¤. ì´ëŸ° ê²½ìš° ê·¸ë¦¼ìì˜ ê²½ê³„ ë¶€ë¶„ì„ ë³´ì •í•´ì£¼ëŠ” ì—¬ëŸ¬ ë°©ë²•ì´ ì¡´ì¬í•˜ëŠ”ë°, ëŒ€í‘œì ìœ¼ë¡œ PCF ê¸°ë²•ì´ ìˆë‹¤.

<br>

![images](https://github.com/inhopp/StyleGAN/assets/96368476/08d25469-eebb-4c77-8005-605d66ba1fac){: width="40%" height="50%"}

``` hlsl
// sampler description in CPU
sampDesc.Filter = D3D11_FILTER_COMPARISON_MIN_MAG_LINEAR_MIP_POINT;
samDesc.ComparionFunc = D3D11_COMPARISON_LESS_EQUAL;


// pixel shader in GPU
// ...
[unroll]
for (int i=0; i<9; i++)
    percentLit += shadowmap.SampleCmpLevelZero(shadowCompareSampler, lightTexcoord.xy, lightScreen.z - 0.001).r;

shadowFactor = percentLit / 9.0;
```

- í”½ì…€ ë‹¨ìœ„ë¡œ ê·¸ë¦¼ì ì˜ì—­(0/1)ì„ íŒë‹¨í•˜ì§€ ì•ŠìŒ
- ì£¼ë³€ í”½ì…€ ê°’ë“¤ì„ ì°¸ì¡°í•˜ì—¬ 0~1ë²”ìœ„ì˜ ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì í‘œí˜„ ê°€ëŠ¥
- SampleCmpLevelZero : MipMap-Level 0ì—ì„œ Sampling
  - ë‚´ë¶€ ë³€ìˆ˜ë“¤ì„ ì´ìš©í•´ shadowMap ë¹„êµ ì•Œì•„ì„œ í•´ì¤Œ 


<br>

| Simple Shadow | PCF Shadow |
|:-:|:-:|
|![3](https://github.com/inhopp/StyleGAN/assets/96368476/9f34d57a-e71c-4ef7-96d1-bf55ada54a5b)|![4](https://github.com/inhopp/StyleGAN/assets/96368476/44be63b9-c142-47eb-bff4-cad561d84431)|



<br>
<br>


[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}